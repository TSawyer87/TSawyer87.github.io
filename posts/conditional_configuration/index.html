<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Conditional_configuration | NixOS Blog</title><meta name=keywords content><meta name=description content='Conditional Configuration
With options it&rsquo;s easy to conditionally install something based on if another
program is enabled in your configuration.
Hyprland Module
For example, if I have an option to enable or disable hyprland like this:
# hyprland.nix
{
  pkgs,
  lib,
  config,
  inputs,
  ...
}: let
  cfg = config.custom.hyprland;
in {
  options.custom.hyprland = {
    enable = lib.mkOption {
      type = lib.types.bool;
      default = false;
      description = "Enable hyprland module";
    };
  };
   config = lib.mkIf cfg.enable {
    home.packages = with pkgs; [
      # swww
      grim
      slurp
      wl-clipboard-rs
      cliphist
      swappy
      ydotool
      wpaperd
      wofi
      hyprpicker
      pavucontrol
      blueman
      # lxqt.lxqt-policykit
      brightnessctl
      polkit_gnome
      wlr-randr
      wtype
      rose-pine-cursor
      # nwg-look
      # yad
      # gtk-engine-murrine
    ];

# .. snip ..


Since the above module is set to false, it is necessary to add
custom.hyprland.enable = true to my home.nix to have Nix add it to my
configuration. And since home.packages is wrapped in
config = lib.mkIf cfg.enable Those packages will only be installed if the
module is enabled.'><meta name=author content="T Sawyer"><link rel=canonical href=https://tsawyer87.github.io/posts/conditional_configuration/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://tsawyer87.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tsawyer87.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tsawyer87.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tsawyer87.github.io/apple-touch-icon.png><link rel=mask-icon href=https://tsawyer87.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tsawyer87.github.io/posts/conditional_configuration/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://tsawyer87.github.io/posts/conditional_configuration/"><meta property="og:site_name" content="NixOS Blog"><meta property="og:title" content="Conditional_configuration"><meta property="og:description" content='Conditional Configuration With options it’s easy to conditionally install something based on if another program is enabled in your configuration.
Hyprland Module For example, if I have an option to enable or disable hyprland like this:
# hyprland.nix { pkgs, lib, config, inputs, ... }: let cfg = config.custom.hyprland; in { options.custom.hyprland = { enable = lib.mkOption { type = lib.types.bool; default = false; description = "Enable hyprland module"; }; }; config = lib.mkIf cfg.enable { home.packages = with pkgs; [ # swww grim slurp wl-clipboard-rs cliphist swappy ydotool wpaperd wofi hyprpicker pavucontrol blueman # lxqt.lxqt-policykit brightnessctl polkit_gnome wlr-randr wtype rose-pine-cursor # nwg-look # yad # gtk-engine-murrine ]; # .. snip .. Since the above module is set to false, it is necessary to add custom.hyprland.enable = true to my home.nix to have Nix add it to my configuration. And since home.packages is wrapped in config = lib.mkIf cfg.enable Those packages will only be installed if the module is enabled.'><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-14T19:21:09-04:00"><meta property="article:modified_time" content="2025-05-14T19:21:09-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Conditional_configuration"><meta name=twitter:description content='Conditional Configuration
With options it&rsquo;s easy to conditionally install something based on if another
program is enabled in your configuration.
Hyprland Module
For example, if I have an option to enable or disable hyprland like this:
# hyprland.nix
{
  pkgs,
  lib,
  config,
  inputs,
  ...
}: let
  cfg = config.custom.hyprland;
in {
  options.custom.hyprland = {
    enable = lib.mkOption {
      type = lib.types.bool;
      default = false;
      description = "Enable hyprland module";
    };
  };
   config = lib.mkIf cfg.enable {
    home.packages = with pkgs; [
      # swww
      grim
      slurp
      wl-clipboard-rs
      cliphist
      swappy
      ydotool
      wpaperd
      wofi
      hyprpicker
      pavucontrol
      blueman
      # lxqt.lxqt-policykit
      brightnessctl
      polkit_gnome
      wlr-randr
      wtype
      rose-pine-cursor
      # nwg-look
      # yad
      # gtk-engine-murrine
    ];

# .. snip ..


Since the above module is set to false, it is necessary to add
custom.hyprland.enable = true to my home.nix to have Nix add it to my
configuration. And since home.packages is wrapped in
config = lib.mkIf cfg.enable Those packages will only be installed if the
module is enabled.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tsawyer87.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Conditional_configuration","item":"https://tsawyer87.github.io/posts/conditional_configuration/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Conditional_configuration","name":"Conditional_configuration","description":"Conditional Configuration With options it\u0026rsquo;s easy to conditionally install something based on if another program is enabled in your configuration.\nHyprland Module For example, if I have an option to enable or disable hyprland like this:\n# hyprland.nix { pkgs, lib, config, inputs, ... }: let cfg = config.custom.hyprland; in { options.custom.hyprland = { enable = lib.mkOption { type = lib.types.bool; default = false; description = \u0026#34;Enable hyprland module\u0026#34;; }; }; config = lib.mkIf cfg.enable { home.packages = with pkgs; [ # swww grim slurp wl-clipboard-rs cliphist swappy ydotool wpaperd wofi hyprpicker pavucontrol blueman # lxqt.lxqt-policykit brightnessctl polkit_gnome wlr-randr wtype rose-pine-cursor # nwg-look # yad # gtk-engine-murrine ]; # .. snip .. Since the above module is set to false, it is necessary to add custom.hyprland.enable = true to my home.nix to have Nix add it to my configuration. And since home.packages is wrapped in config = lib.mkIf cfg.enable Those packages will only be installed if the module is enabled.\n","keywords":[],"articleBody":"Conditional Configuration With options it’s easy to conditionally install something based on if another program is enabled in your configuration.\nHyprland Module For example, if I have an option to enable or disable hyprland like this:\n# hyprland.nix { pkgs, lib, config, inputs, ... }: let cfg = config.custom.hyprland; in { options.custom.hyprland = { enable = lib.mkOption { type = lib.types.bool; default = false; description = \"Enable hyprland module\"; }; }; config = lib.mkIf cfg.enable { home.packages = with pkgs; [ # swww grim slurp wl-clipboard-rs cliphist swappy ydotool wpaperd wofi hyprpicker pavucontrol blueman # lxqt.lxqt-policykit brightnessctl polkit_gnome wlr-randr wtype rose-pine-cursor # nwg-look # yad # gtk-engine-murrine ]; # .. snip .. Since the above module is set to false, it is necessary to add custom.hyprland.enable = true to my home.nix to have Nix add it to my configuration. And since home.packages is wrapped in config = lib.mkIf cfg.enable Those packages will only be installed if the module is enabled.\nif I used programs.hyprland.enable and added home.packages = [ pkgs.waybar ]; without conditionals, waybar would install even if hyprland was disabled.\nWlogout Module I can then have my default for something like wlogout be to install only if the custom.hyprland module is enabled:\n# wlogout.nix { config, lib, ... }: let cfg = config.custom.wlogout; in { options.custom.wlogout = { enable = lib.mkOption { type = lib.types.bool; default = config.custom.hyprland.enable; description = \"Enable wlogout module\"; }; }; config = lib.mkIf cfg.enable { programs.wlogout = { enable = true; } } # .. snip .. The default value of config.custom.wlogout.enable is set to config.custom.hyprland.enable. Therefore, if config.custom.hyprland.enable evaluates to true, the wlogout module will be enabled by default. Benefits of this Approach The lib.mkIf cfg.enable ensures that wlogout’s configuration (e.g., enabling programs.wlogout) is only applied when custom.wlogout.enable = true, which defaults to custom.hyprland.enable. This means wlogout is enabled by default only if Hyprland is enabled, but I can override this (e.g., custom.wlogout.enable = true without Hyprland). This conditional logic prevents wlogout from being installed unnecessarily when Hyprland is disabled, unlike a simpler approach like programs.wlogout. enable = config.programs.hyprland.enable, which hardcodes the dependency and offers less flexibility.\n","wordCount":"354","inLanguage":"en","datePublished":"2025-05-14T19:21:09-04:00","dateModified":"2025-05-14T19:21:09-04:00","author":{"@type":"Person","name":"T Sawyer"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tsawyer87.github.io/posts/conditional_configuration/"},"publisher":{"@type":"Organization","name":"NixOS Blog","logo":{"@type":"ImageObject","url":"https://tsawyer87.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tsawyer87.github.io/ accesskey=h title="NixOS Blog (Alt + H)">NixOS Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
<a href=/index.xml title="RSS Feed"><img src=/images/rss.png alt="RSS Feed" style=width:24px;height:24px></a></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Conditional_configuration</h1><div class=post-meta><span title='2025-05-14 19:21:09 -0400 EDT'>May 14, 2025</span>&nbsp;·&nbsp;T Sawyer</div></header><div class=post-content><h1 id=conditional-configuration>Conditional Configuration<a hidden class=anchor aria-hidden=true href=#conditional-configuration>#</a></h1><p>With options it&rsquo;s easy to conditionally install something based on if another
program is enabled in your configuration.</p><h2 id=hyprland-module>Hyprland Module<a hidden class=anchor aria-hidden=true href=#hyprland-module>#</a></h2><p>For example, if I have an option to enable or disable hyprland like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># hyprland.nix</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  pkgs<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  lib<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  config<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  inputs<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}: <span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>  cfg <span style=color:#f92672>=</span> config<span style=color:#f92672>.</span>custom<span style=color:#f92672>.</span>hyprland;
</span></span><span style=display:flex><span><span style=color:#66d9ef>in</span> {
</span></span><span style=display:flex><span>  options<span style=color:#f92672>.</span>custom<span style=color:#f92672>.</span>hyprland <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>mkOption {
</span></span><span style=display:flex><span>      type <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>types<span style=color:#f92672>.</span>bool;
</span></span><span style=display:flex><span>      default <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>      description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enable hyprland module&#34;</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>   config <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>mkIf cfg<span style=color:#f92672>.</span>enable {
</span></span><span style=display:flex><span>    home<span style=color:#f92672>.</span>packages <span style=color:#f92672>=</span> <span style=color:#66d9ef>with</span> pkgs; [
</span></span><span style=display:flex><span>      <span style=color:#75715e># swww</span>
</span></span><span style=display:flex><span>      grim
</span></span><span style=display:flex><span>      slurp
</span></span><span style=display:flex><span>      wl-clipboard-rs
</span></span><span style=display:flex><span>      cliphist
</span></span><span style=display:flex><span>      swappy
</span></span><span style=display:flex><span>      ydotool
</span></span><span style=display:flex><span>      wpaperd
</span></span><span style=display:flex><span>      wofi
</span></span><span style=display:flex><span>      hyprpicker
</span></span><span style=display:flex><span>      pavucontrol
</span></span><span style=display:flex><span>      blueman
</span></span><span style=display:flex><span>      <span style=color:#75715e># lxqt.lxqt-policykit</span>
</span></span><span style=display:flex><span>      brightnessctl
</span></span><span style=display:flex><span>      polkit_gnome
</span></span><span style=display:flex><span>      wlr-randr
</span></span><span style=display:flex><span>      wtype
</span></span><span style=display:flex><span>      rose-pine-cursor
</span></span><span style=display:flex><span>      <span style=color:#75715e># nwg-look</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># yad</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># gtk-engine-murrine</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># .. snip ..</span>
</span></span></code></pre></div><ul><li><p>Since the above module is set to false, it is necessary to add
<code>custom.hyprland.enable = true</code> to my <code>home.nix</code> to have Nix add it to my
configuration. And since <code>home.packages</code> is wrapped in
<code>config = lib.mkIf cfg.enable</code> Those packages will only be installed if the
module is enabled.</p></li><li><p>if I used <code>programs.hyprland.enable</code> and added
<code>home.packages = [ pkgs.waybar ];</code> without conditionals, waybar would install
even if hyprland was disabled.</p></li></ul><h2 id=wlogout-module>Wlogout Module<a hidden class=anchor aria-hidden=true href=#wlogout-module>#</a></h2><p>I can then have my default for something like wlogout be to install only if the
<code>custom.hyprland</code> module is enabled:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># wlogout.nix</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  config<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  lib<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}: <span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>  cfg <span style=color:#f92672>=</span> config<span style=color:#f92672>.</span>custom<span style=color:#f92672>.</span>wlogout;
</span></span><span style=display:flex><span><span style=color:#66d9ef>in</span> {
</span></span><span style=display:flex><span>  options<span style=color:#f92672>.</span>custom<span style=color:#f92672>.</span>wlogout <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>mkOption {
</span></span><span style=display:flex><span>      type <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>types<span style=color:#f92672>.</span>bool;
</span></span><span style=display:flex><span>      default <span style=color:#f92672>=</span> config<span style=color:#f92672>.</span>custom<span style=color:#f92672>.</span>hyprland<span style=color:#f92672>.</span>enable;
</span></span><span style=display:flex><span>      description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Enable wlogout module&#34;</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>    config <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>mkIf cfg<span style=color:#f92672>.</span>enable {
</span></span><span style=display:flex><span>    programs<span style=color:#f92672>.</span>wlogout <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#75715e># .. snip ..</span>
</span></span></code></pre></div><ul><li>The default value of <code>config.custom.wlogout.enable</code> is set to
<code>config.custom.hyprland.enable</code>. Therefore, if <code>config.custom.hyprland.enable</code>
evaluates to true, the wlogout module will be enabled by default.</li></ul><h2 id=benefits-of-this-approach>Benefits of this Approach<a hidden class=anchor aria-hidden=true href=#benefits-of-this-approach>#</a></h2><p>The <code>lib.mkIf cfg.enable</code> ensures that wlogout’s configuration (e.g., enabling
<code>programs.wlogout</code>) is only applied when <code>custom.wlogout.enable = true</code>, which
defaults to <code>custom.hyprland.enable</code>. This means wlogout is enabled by default
only if Hyprland is enabled, but I can override this (e.g.,
<code>custom.wlogout.enable = true</code> without Hyprland). This conditional logic
prevents wlogout from being installed unnecessarily when Hyprland is disabled,
unlike a simpler approach like
<code>programs.wlogout. enable = config.programs.hyprland.enable</code>, which hardcodes
the dependency and offers less flexibility.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tsawyer87.github.io/>NixOS Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>