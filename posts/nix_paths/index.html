<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nix_paths | NixOS Blog</title><meta name=keywords content><meta name=description content='Nix Paths
The following examples are done with a local nixpkgs clone located at
~/src/nixpkgs
Paths in Nix always need a / in them and always expand to absolute paths
relative to your current directory.
nix repl
nix-repl> ./.
/home/jr/src/nixpkgs
nix-repl> ./. + "/lib"
/home/jr/src/nixpkgs/lib
Nix does path normalization every time you append strings, so if you just add
a slash / its not actually there:
nix-repl> ./.
/home/jr/src/nixpkgs
nix-repl> ./. + "/"
/home/jr/src/nixpkgs
nix-repl> ./. + "/" + "lib"
/home/jr/src/nixpkgslib
nix-repl> "${./.}/lib"
# using ${./.} causes a store copy
copying &#39;/homr/jr/src/nixpkgs&#39; to the store
"/nix/store/3z9fzx8z03wslxvri5syv3jnnhn5fkbd-nixpkgs/lib"
nix-repl> "${toString ./.}/lib"
# using toString avoids making a store copy
"/home/jr/src/nixpkgs/lib"
nix-repl> ./lib/..             # nix removes all `..` to avoid redundant path resolutions
/home/jr/src/nixpkgs
nix-repl> :q
realpath ./lib/..
/home/jr/src/nixpkgs
ln -s pkgs/applications lib-symlink
realpath ./lib-symlink/..
/home/jr/src/nixpkgs/pkgs
nix repl
nix-repl> ./lib-symlink/..   # Nix doesn&#39;t read this file at all like realpath did
/home/jr/src/nixpkgs
nix-repl> builtins.readDir ./. # listing of all entries in current dir and their types
{
  ".devcontainer" = "directory";
  ".editorconfig" = "regular";
  ".git" = "directory";
  ".git-blame-ignore-revs" = "regular";
  ".gitattributes" = "regular";
  ".github" = "directory";
  ".gitignore" = "regular";
  ".mailmap" = "regular";
  ".mergify.yml" = "regular";
  ".version" = "symlink";
  "CONTRIBUTING.md" = "regular";
  COPYING = "regular";
  "README.md" = "regular";
  ci = "directory";
  "default.nix" = "regular";
  doc = "directory";
  "flake.nix" = "regular";
  lib = "directory";
  maintainers = "directory";
  nixos = "directory";
  pkgs = "directory";
  "shell.nix" = "regular";
}
nix-repl> builtins.readFile ./default.nix
"let\n  requiredVersion = import ./lib/minver.nix;\nin\n\nif !builtins ? nixVersion
 || builtins.compareVersions requiredVersion builtins.nixVersion == 1 then\n\n  abort
 &#39;&#39;\n\n    This version of Nixpkgs requires Nix >= \${requiredVersion}, please
 upgrade:\n\n    - If you are running NixOS, `nixos-rebuild&#39; can be used to upgrade
 your system.\n\n    - Alternatively, with Nix > 2.0 `nix upgrade-nix&#39; can be used
 to imperatively\n      upgrade Nix. You may use `nix-env --version&#39; to check which
 version you have.\n\n    - If you installed Nix using the install script (https://nixos.org/nix/install),\n
  it is safe to upgrade by running it again:\n\n          curl -L https://nixos.org/nix/install | sh\n\n
For more information, please see the NixOS release notes at\n    https://nixos.org/nixos/manual
 or locally at\n    \${toString ./nixos/doc/manual/release-notes}.\n\n    If you need further help,
 see https://nixos.org/nixos/support.html\n  &#39;&#39;\n\nelse\n\n  import ./pkgs/top-level/impure.nix\n"
nix-repl> :l <nixpkgs/lib>
nix-repl> importJSON ./pkgs/development/python-modules/notebook/missing-hashes.json # Return the nix value for JSON
{
  "@nx/nx-darwin-arm64@npm:16.10.0" = "aabcc8499602b98c9fc3b768fe46dfd4e1b818caa84b740bd4f73a2e4528c719b979ecb1c10a0d793a1fead83073a08bc86417588046aa3e587e80af880bffd3";
  "@nx/nx-darwin-x64@npm:16.10.0" = "9dd20f45f646d05306f23f5abb7ade69dcb962e23a013101e93365847722079656d30a19c735fdcfa5c4e0fdf08691f9d621073c58aef2861c26741ff4638375";
  "@nx/nx-freebsd-x64@npm:16.10.0" = "35b93aabe3b3274d53157a6fc10fec7e341e75e6818e96cfbc89c3d5b955d225ca80a173630b6aa43c448c6b53b23f06a2699a25c0c8bc71396ee20a023d035f";
  "@nx/nx-linux-arm-gnueabihf@npm:16.10.0" = "697b9fa4c70f84d3ea8fe32d47635864f2e40b0ceeb1484126598c61851a2ec34b56bb3eeb9654c37d9b14e81ce85a36ac38946b4b90ca403c57fe448be51ccb";
  "@nx/nx-linux-arm64-gnu@npm:16.10.0" = "001e71fedfc763a4dedd6c5901b66a4a790d388673fb74675235e19bb8fe031ff3755568ed867513dd003f873901fabda31a7d5628b39095535cb9f6d1dc7191";
  "@nx/nx-linux-arm64-musl@npm:16.10.0" = "58e3b71571bdadd2b0ddd24ea6e30cd795e706ada69f685403412c518fba1a2011ac8c2ac46145eab14649aa5a78e0cedcdb4d327ccb3b6ec12e055171f3840b";
  "@nx/nx-linux-x64-gnu@npm:16.10.0" = "97729a7efb27301a67ebf34739784114528ddb54047e63ca110a985eaa0763c5b1ea7c623ead1a2266d07107951be81e82ffa0a30e6e4d97506659303f2c8c78";
  "@nx/nx-linux-x64-musl@npm:16.10.0" = "442bdbd5e61324a850e4e7bd6f54204108580299d3c7c4ebcec324da9a63e23f48d797a87593400fc32af78a3a03a3c104bfb360f107fe732e6a6c289863853a";
  "@nx/nx-win32-arm64-msvc@npm:16.10.0" = "b5c74184ebfc70294e85f8e309f81c3d40b5cf99068891e613f3bef5ddb946bef7c9942d9e6c7688e22006d45d786342359af3b4fc87aadf369afcda55c73187";
  "@nx/nx-win32-x64-msvc@npm:16.10.0" = "c5b174ebd7a5916246088e17d3761804b88f010b6b3f930034fa49af00da33b6d1352728c733024f736e4c2287def75bafdc3d60d8738bd24b67e9a4f11763f8";
}
nix-repl> builtins.toJSON  # serialize
«primop toJSON»
nix-repl> builtins.fromTOML
«primop fromTOML»
nix-repl> builtins.toXML
For more serialization formats see nixpkgs/lib/generators.nix as well as in
nixpkgs/pkgs/pkgs-lib/formats/ we can see them with the nix repl as follows:'><meta name=author content><link rel=canonical href=https://tsawyer87.github.io/posts/nix_paths/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://tsawyer87.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tsawyer87.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tsawyer87.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tsawyer87.github.io/apple-touch-icon.png><link rel=mask-icon href=https://tsawyer87.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tsawyer87.github.io/posts/nix_paths/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://tsawyer87.github.io/posts/nix_paths/"><meta property="og:site_name" content="NixOS Blog"><meta property="og:title" content="Nix_paths"><meta property="og:description" content='Nix Paths The following examples are done with a local nixpkgs clone located at ~/src/nixpkgs
Paths in Nix always need a / in them and always expand to absolute paths relative to your current directory.
nix repl nix-repl> ./. /home/jr/src/nixpkgs nix-repl> ./. + "/lib" /home/jr/src/nixpkgs/lib Nix does path normalization every time you append strings, so if you just add a slash / its not actually there:
nix-repl> ./. /home/jr/src/nixpkgs nix-repl> ./. + "/" /home/jr/src/nixpkgs nix-repl> ./. + "/" + "lib" /home/jr/src/nixpkgslib nix-repl> "${./.}/lib" # using ${./.} causes a store copy copying &#39;/homr/jr/src/nixpkgs&#39; to the store "/nix/store/3z9fzx8z03wslxvri5syv3jnnhn5fkbd-nixpkgs/lib" nix-repl> "${toString ./.}/lib" # using toString avoids making a store copy "/home/jr/src/nixpkgs/lib" nix-repl> ./lib/.. # nix removes all `..` to avoid redundant path resolutions /home/jr/src/nixpkgs nix-repl> :q realpath ./lib/.. /home/jr/src/nixpkgs ln -s pkgs/applications lib-symlink realpath ./lib-symlink/.. /home/jr/src/nixpkgs/pkgs nix repl nix-repl> ./lib-symlink/.. # Nix doesn&#39;t read this file at all like realpath did /home/jr/src/nixpkgs nix-repl> builtins.readDir ./. # listing of all entries in current dir and their types { ".devcontainer" = "directory"; ".editorconfig" = "regular"; ".git" = "directory"; ".git-blame-ignore-revs" = "regular"; ".gitattributes" = "regular"; ".github" = "directory"; ".gitignore" = "regular"; ".mailmap" = "regular"; ".mergify.yml" = "regular"; ".version" = "symlink"; "CONTRIBUTING.md" = "regular"; COPYING = "regular"; "README.md" = "regular"; ci = "directory"; "default.nix" = "regular"; doc = "directory"; "flake.nix" = "regular"; lib = "directory"; maintainers = "directory"; nixos = "directory"; pkgs = "directory"; "shell.nix" = "regular"; } nix-repl> builtins.readFile ./default.nix "let\n requiredVersion = import ./lib/minver.nix;\nin\n\nif !builtins ? nixVersion || builtins.compareVersions requiredVersion builtins.nixVersion == 1 then\n\n abort &#39;&#39;\n\n This version of Nixpkgs requires Nix >= \${requiredVersion}, please upgrade:\n\n - If you are running NixOS, `nixos-rebuild&#39; can be used to upgrade your system.\n\n - Alternatively, with Nix > 2.0 `nix upgrade-nix&#39; can be used to imperatively\n upgrade Nix. You may use `nix-env --version&#39; to check which version you have.\n\n - If you installed Nix using the install script (https://nixos.org/nix/install),\n it is safe to upgrade by running it again:\n\n curl -L https://nixos.org/nix/install | sh\n\n For more information, please see the NixOS release notes at\n https://nixos.org/nixos/manual or locally at\n \${toString ./nixos/doc/manual/release-notes}.\n\n If you need further help, see https://nixos.org/nixos/support.html\n &#39;&#39;\n\nelse\n\n import ./pkgs/top-level/impure.nix\n" nix-repl> :l <nixpkgs/lib> nix-repl> importJSON ./pkgs/development/python-modules/notebook/missing-hashes.json # Return the nix value for JSON { "@nx/nx-darwin-arm64@npm:16.10.0" = "aabcc8499602b98c9fc3b768fe46dfd4e1b818caa84b740bd4f73a2e4528c719b979ecb1c10a0d793a1fead83073a08bc86417588046aa3e587e80af880bffd3"; "@nx/nx-darwin-x64@npm:16.10.0" = "9dd20f45f646d05306f23f5abb7ade69dcb962e23a013101e93365847722079656d30a19c735fdcfa5c4e0fdf08691f9d621073c58aef2861c26741ff4638375"; "@nx/nx-freebsd-x64@npm:16.10.0" = "35b93aabe3b3274d53157a6fc10fec7e341e75e6818e96cfbc89c3d5b955d225ca80a173630b6aa43c448c6b53b23f06a2699a25c0c8bc71396ee20a023d035f"; "@nx/nx-linux-arm-gnueabihf@npm:16.10.0" = "697b9fa4c70f84d3ea8fe32d47635864f2e40b0ceeb1484126598c61851a2ec34b56bb3eeb9654c37d9b14e81ce85a36ac38946b4b90ca403c57fe448be51ccb"; "@nx/nx-linux-arm64-gnu@npm:16.10.0" = "001e71fedfc763a4dedd6c5901b66a4a790d388673fb74675235e19bb8fe031ff3755568ed867513dd003f873901fabda31a7d5628b39095535cb9f6d1dc7191"; "@nx/nx-linux-arm64-musl@npm:16.10.0" = "58e3b71571bdadd2b0ddd24ea6e30cd795e706ada69f685403412c518fba1a2011ac8c2ac46145eab14649aa5a78e0cedcdb4d327ccb3b6ec12e055171f3840b"; "@nx/nx-linux-x64-gnu@npm:16.10.0" = "97729a7efb27301a67ebf34739784114528ddb54047e63ca110a985eaa0763c5b1ea7c623ead1a2266d07107951be81e82ffa0a30e6e4d97506659303f2c8c78"; "@nx/nx-linux-x64-musl@npm:16.10.0" = "442bdbd5e61324a850e4e7bd6f54204108580299d3c7c4ebcec324da9a63e23f48d797a87593400fc32af78a3a03a3c104bfb360f107fe732e6a6c289863853a"; "@nx/nx-win32-arm64-msvc@npm:16.10.0" = "b5c74184ebfc70294e85f8e309f81c3d40b5cf99068891e613f3bef5ddb946bef7c9942d9e6c7688e22006d45d786342359af3b4fc87aadf369afcda55c73187"; "@nx/nx-win32-x64-msvc@npm:16.10.0" = "c5b174ebd7a5916246088e17d3761804b88f010b6b3f930034fa49af00da33b6d1352728c733024f736e4c2287def75bafdc3d60d8738bd24b67e9a4f11763f8"; } nix-repl> builtins.toJSON # serialize «primop toJSON» nix-repl> builtins.fromTOML «primop fromTOML» nix-repl> builtins.toXML For more serialization formats see nixpkgs/lib/generators.nix as well as in nixpkgs/pkgs/pkgs-lib/formats/ we can see them with the nix repl as follows:'><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-15T18:21:05-04:00"><meta property="article:modified_time" content="2025-06-15T18:21:05-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nix_paths"><meta name=twitter:description content='Nix Paths
The following examples are done with a local nixpkgs clone located at
~/src/nixpkgs
Paths in Nix always need a / in them and always expand to absolute paths
relative to your current directory.
nix repl
nix-repl> ./.
/home/jr/src/nixpkgs
nix-repl> ./. + "/lib"
/home/jr/src/nixpkgs/lib
Nix does path normalization every time you append strings, so if you just add
a slash / its not actually there:
nix-repl> ./.
/home/jr/src/nixpkgs
nix-repl> ./. + "/"
/home/jr/src/nixpkgs
nix-repl> ./. + "/" + "lib"
/home/jr/src/nixpkgslib
nix-repl> "${./.}/lib"
# using ${./.} causes a store copy
copying &#39;/homr/jr/src/nixpkgs&#39; to the store
"/nix/store/3z9fzx8z03wslxvri5syv3jnnhn5fkbd-nixpkgs/lib"
nix-repl> "${toString ./.}/lib"
# using toString avoids making a store copy
"/home/jr/src/nixpkgs/lib"
nix-repl> ./lib/..             # nix removes all `..` to avoid redundant path resolutions
/home/jr/src/nixpkgs
nix-repl> :q
realpath ./lib/..
/home/jr/src/nixpkgs
ln -s pkgs/applications lib-symlink
realpath ./lib-symlink/..
/home/jr/src/nixpkgs/pkgs
nix repl
nix-repl> ./lib-symlink/..   # Nix doesn&#39;t read this file at all like realpath did
/home/jr/src/nixpkgs
nix-repl> builtins.readDir ./. # listing of all entries in current dir and their types
{
  ".devcontainer" = "directory";
  ".editorconfig" = "regular";
  ".git" = "directory";
  ".git-blame-ignore-revs" = "regular";
  ".gitattributes" = "regular";
  ".github" = "directory";
  ".gitignore" = "regular";
  ".mailmap" = "regular";
  ".mergify.yml" = "regular";
  ".version" = "symlink";
  "CONTRIBUTING.md" = "regular";
  COPYING = "regular";
  "README.md" = "regular";
  ci = "directory";
  "default.nix" = "regular";
  doc = "directory";
  "flake.nix" = "regular";
  lib = "directory";
  maintainers = "directory";
  nixos = "directory";
  pkgs = "directory";
  "shell.nix" = "regular";
}
nix-repl> builtins.readFile ./default.nix
"let\n  requiredVersion = import ./lib/minver.nix;\nin\n\nif !builtins ? nixVersion
 || builtins.compareVersions requiredVersion builtins.nixVersion == 1 then\n\n  abort
 &#39;&#39;\n\n    This version of Nixpkgs requires Nix >= \${requiredVersion}, please
 upgrade:\n\n    - If you are running NixOS, `nixos-rebuild&#39; can be used to upgrade
 your system.\n\n    - Alternatively, with Nix > 2.0 `nix upgrade-nix&#39; can be used
 to imperatively\n      upgrade Nix. You may use `nix-env --version&#39; to check which
 version you have.\n\n    - If you installed Nix using the install script (https://nixos.org/nix/install),\n
  it is safe to upgrade by running it again:\n\n          curl -L https://nixos.org/nix/install | sh\n\n
For more information, please see the NixOS release notes at\n    https://nixos.org/nixos/manual
 or locally at\n    \${toString ./nixos/doc/manual/release-notes}.\n\n    If you need further help,
 see https://nixos.org/nixos/support.html\n  &#39;&#39;\n\nelse\n\n  import ./pkgs/top-level/impure.nix\n"
nix-repl> :l <nixpkgs/lib>
nix-repl> importJSON ./pkgs/development/python-modules/notebook/missing-hashes.json # Return the nix value for JSON
{
  "@nx/nx-darwin-arm64@npm:16.10.0" = "aabcc8499602b98c9fc3b768fe46dfd4e1b818caa84b740bd4f73a2e4528c719b979ecb1c10a0d793a1fead83073a08bc86417588046aa3e587e80af880bffd3";
  "@nx/nx-darwin-x64@npm:16.10.0" = "9dd20f45f646d05306f23f5abb7ade69dcb962e23a013101e93365847722079656d30a19c735fdcfa5c4e0fdf08691f9d621073c58aef2861c26741ff4638375";
  "@nx/nx-freebsd-x64@npm:16.10.0" = "35b93aabe3b3274d53157a6fc10fec7e341e75e6818e96cfbc89c3d5b955d225ca80a173630b6aa43c448c6b53b23f06a2699a25c0c8bc71396ee20a023d035f";
  "@nx/nx-linux-arm-gnueabihf@npm:16.10.0" = "697b9fa4c70f84d3ea8fe32d47635864f2e40b0ceeb1484126598c61851a2ec34b56bb3eeb9654c37d9b14e81ce85a36ac38946b4b90ca403c57fe448be51ccb";
  "@nx/nx-linux-arm64-gnu@npm:16.10.0" = "001e71fedfc763a4dedd6c5901b66a4a790d388673fb74675235e19bb8fe031ff3755568ed867513dd003f873901fabda31a7d5628b39095535cb9f6d1dc7191";
  "@nx/nx-linux-arm64-musl@npm:16.10.0" = "58e3b71571bdadd2b0ddd24ea6e30cd795e706ada69f685403412c518fba1a2011ac8c2ac46145eab14649aa5a78e0cedcdb4d327ccb3b6ec12e055171f3840b";
  "@nx/nx-linux-x64-gnu@npm:16.10.0" = "97729a7efb27301a67ebf34739784114528ddb54047e63ca110a985eaa0763c5b1ea7c623ead1a2266d07107951be81e82ffa0a30e6e4d97506659303f2c8c78";
  "@nx/nx-linux-x64-musl@npm:16.10.0" = "442bdbd5e61324a850e4e7bd6f54204108580299d3c7c4ebcec324da9a63e23f48d797a87593400fc32af78a3a03a3c104bfb360f107fe732e6a6c289863853a";
  "@nx/nx-win32-arm64-msvc@npm:16.10.0" = "b5c74184ebfc70294e85f8e309f81c3d40b5cf99068891e613f3bef5ddb946bef7c9942d9e6c7688e22006d45d786342359af3b4fc87aadf369afcda55c73187";
  "@nx/nx-win32-x64-msvc@npm:16.10.0" = "c5b174ebd7a5916246088e17d3761804b88f010b6b3f930034fa49af00da33b6d1352728c733024f736e4c2287def75bafdc3d60d8738bd24b67e9a4f11763f8";
}
nix-repl> builtins.toJSON  # serialize
«primop toJSON»
nix-repl> builtins.fromTOML
«primop fromTOML»
nix-repl> builtins.toXML
For more serialization formats see nixpkgs/lib/generators.nix as well as in
nixpkgs/pkgs/pkgs-lib/formats/ we can see them with the nix repl as follows:'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tsawyer87.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Nix_paths","item":"https://tsawyer87.github.io/posts/nix_paths/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nix_paths","name":"Nix_paths","description":"Nix Paths The following examples are done with a local nixpkgs clone located at ~/src/nixpkgs\nPaths in Nix always need a / in them and always expand to absolute paths relative to your current directory.\nnix repl nix-repl\u0026gt; ./. /home/jr/src/nixpkgs nix-repl\u0026gt; ./. + \u0026#34;/lib\u0026#34; /home/jr/src/nixpkgs/lib Nix does path normalization every time you append strings, so if you just add a slash / its not actually there:\nnix-repl\u0026gt; ./. /home/jr/src/nixpkgs nix-repl\u0026gt; ./. + \u0026#34;/\u0026#34; /home/jr/src/nixpkgs nix-repl\u0026gt; ./. + \u0026#34;/\u0026#34; + \u0026#34;lib\u0026#34; /home/jr/src/nixpkgslib nix-repl\u0026gt; \u0026#34;${./.}/lib\u0026#34; # using ${./.} causes a store copy copying \u0026#39;/homr/jr/src/nixpkgs\u0026#39; to the store \u0026#34;/nix/store/3z9fzx8z03wslxvri5syv3jnnhn5fkbd-nixpkgs/lib\u0026#34; nix-repl\u0026gt; \u0026#34;${toString ./.}/lib\u0026#34; # using toString avoids making a store copy \u0026#34;/home/jr/src/nixpkgs/lib\u0026#34; nix-repl\u0026gt; ./lib/.. # nix removes all `..` to avoid redundant path resolutions /home/jr/src/nixpkgs nix-repl\u0026gt; :q realpath ./lib/.. /home/jr/src/nixpkgs ln -s pkgs/applications lib-symlink realpath ./lib-symlink/.. /home/jr/src/nixpkgs/pkgs nix repl nix-repl\u0026gt; ./lib-symlink/.. # Nix doesn\u0026#39;t read this file at all like realpath did /home/jr/src/nixpkgs nix-repl\u0026gt; builtins.readDir ./. # listing of all entries in current dir and their types { \u0026#34;.devcontainer\u0026#34; = \u0026#34;directory\u0026#34;; \u0026#34;.editorconfig\u0026#34; = \u0026#34;regular\u0026#34;; \u0026#34;.git\u0026#34; = \u0026#34;directory\u0026#34;; \u0026#34;.git-blame-ignore-revs\u0026#34; = \u0026#34;regular\u0026#34;; \u0026#34;.gitattributes\u0026#34; = \u0026#34;regular\u0026#34;; \u0026#34;.github\u0026#34; = \u0026#34;directory\u0026#34;; \u0026#34;.gitignore\u0026#34; = \u0026#34;regular\u0026#34;; \u0026#34;.mailmap\u0026#34; = \u0026#34;regular\u0026#34;; \u0026#34;.mergify.yml\u0026#34; = \u0026#34;regular\u0026#34;; \u0026#34;.version\u0026#34; = \u0026#34;symlink\u0026#34;; \u0026#34;CONTRIBUTING.md\u0026#34; = \u0026#34;regular\u0026#34;; COPYING = \u0026#34;regular\u0026#34;; \u0026#34;README.md\u0026#34; = \u0026#34;regular\u0026#34;; ci = \u0026#34;directory\u0026#34;; \u0026#34;default.nix\u0026#34; = \u0026#34;regular\u0026#34;; doc = \u0026#34;directory\u0026#34;; \u0026#34;flake.nix\u0026#34; = \u0026#34;regular\u0026#34;; lib = \u0026#34;directory\u0026#34;; maintainers = \u0026#34;directory\u0026#34;; nixos = \u0026#34;directory\u0026#34;; pkgs = \u0026#34;directory\u0026#34;; \u0026#34;shell.nix\u0026#34; = \u0026#34;regular\u0026#34;; } nix-repl\u0026gt; builtins.readFile ./default.nix \u0026#34;let\\n requiredVersion = import ./lib/minver.nix;\\nin\\n\\nif !builtins ? nixVersion || builtins.compareVersions requiredVersion builtins.nixVersion == 1 then\\n\\n abort \u0026#39;\u0026#39;\\n\\n This version of Nixpkgs requires Nix \u0026gt;= \\${requiredVersion}, please upgrade:\\n\\n - If you are running NixOS, `nixos-rebuild\u0026#39; can be used to upgrade your system.\\n\\n - Alternatively, with Nix \u0026gt; 2.0 `nix upgrade-nix\u0026#39; can be used to imperatively\\n upgrade Nix. You may use `nix-env --version\u0026#39; to check which version you have.\\n\\n - If you installed Nix using the install script (https://nixos.org/nix/install),\\n it is safe to upgrade by running it again:\\n\\n curl -L https://nixos.org/nix/install | sh\\n\\n For more information, please see the NixOS release notes at\\n https://nixos.org/nixos/manual or locally at\\n \\${toString ./nixos/doc/manual/release-notes}.\\n\\n If you need further help, see https://nixos.org/nixos/support.html\\n \u0026#39;\u0026#39;\\n\\nelse\\n\\n import ./pkgs/top-level/impure.nix\\n\u0026#34; nix-repl\u0026gt; :l \u0026lt;nixpkgs/lib\u0026gt; nix-repl\u0026gt; importJSON ./pkgs/development/python-modules/notebook/missing-hashes.json # Return the nix value for JSON { \u0026#34;@nx/nx-darwin-arm64@npm:16.10.0\u0026#34; = \u0026#34;aabcc8499602b98c9fc3b768fe46dfd4e1b818caa84b740bd4f73a2e4528c719b979ecb1c10a0d793a1fead83073a08bc86417588046aa3e587e80af880bffd3\u0026#34;; \u0026#34;@nx/nx-darwin-x64@npm:16.10.0\u0026#34; = \u0026#34;9dd20f45f646d05306f23f5abb7ade69dcb962e23a013101e93365847722079656d30a19c735fdcfa5c4e0fdf08691f9d621073c58aef2861c26741ff4638375\u0026#34;; \u0026#34;@nx/nx-freebsd-x64@npm:16.10.0\u0026#34; = \u0026#34;35b93aabe3b3274d53157a6fc10fec7e341e75e6818e96cfbc89c3d5b955d225ca80a173630b6aa43c448c6b53b23f06a2699a25c0c8bc71396ee20a023d035f\u0026#34;; \u0026#34;@nx/nx-linux-arm-gnueabihf@npm:16.10.0\u0026#34; = \u0026#34;697b9fa4c70f84d3ea8fe32d47635864f2e40b0ceeb1484126598c61851a2ec34b56bb3eeb9654c37d9b14e81ce85a36ac38946b4b90ca403c57fe448be51ccb\u0026#34;; \u0026#34;@nx/nx-linux-arm64-gnu@npm:16.10.0\u0026#34; = \u0026#34;001e71fedfc763a4dedd6c5901b66a4a790d388673fb74675235e19bb8fe031ff3755568ed867513dd003f873901fabda31a7d5628b39095535cb9f6d1dc7191\u0026#34;; \u0026#34;@nx/nx-linux-arm64-musl@npm:16.10.0\u0026#34; = \u0026#34;58e3b71571bdadd2b0ddd24ea6e30cd795e706ada69f685403412c518fba1a2011ac8c2ac46145eab14649aa5a78e0cedcdb4d327ccb3b6ec12e055171f3840b\u0026#34;; \u0026#34;@nx/nx-linux-x64-gnu@npm:16.10.0\u0026#34; = \u0026#34;97729a7efb27301a67ebf34739784114528ddb54047e63ca110a985eaa0763c5b1ea7c623ead1a2266d07107951be81e82ffa0a30e6e4d97506659303f2c8c78\u0026#34;; \u0026#34;@nx/nx-linux-x64-musl@npm:16.10.0\u0026#34; = \u0026#34;442bdbd5e61324a850e4e7bd6f54204108580299d3c7c4ebcec324da9a63e23f48d797a87593400fc32af78a3a03a3c104bfb360f107fe732e6a6c289863853a\u0026#34;; \u0026#34;@nx/nx-win32-arm64-msvc@npm:16.10.0\u0026#34; = \u0026#34;b5c74184ebfc70294e85f8e309f81c3d40b5cf99068891e613f3bef5ddb946bef7c9942d9e6c7688e22006d45d786342359af3b4fc87aadf369afcda55c73187\u0026#34;; \u0026#34;@nx/nx-win32-x64-msvc@npm:16.10.0\u0026#34; = \u0026#34;c5b174ebd7a5916246088e17d3761804b88f010b6b3f930034fa49af00da33b6d1352728c733024f736e4c2287def75bafdc3d60d8738bd24b67e9a4f11763f8\u0026#34;; } nix-repl\u0026gt; builtins.toJSON # serialize «primop toJSON» nix-repl\u0026gt; builtins.fromTOML «primop fromTOML» nix-repl\u0026gt; builtins.toXML For more serialization formats see nixpkgs/lib/generators.nix as well as in nixpkgs/pkgs/pkgs-lib/formats/ we can see them with the nix repl as follows:\n","keywords":[],"articleBody":"Nix Paths The following examples are done with a local nixpkgs clone located at ~/src/nixpkgs\nPaths in Nix always need a / in them and always expand to absolute paths relative to your current directory.\nnix repl nix-repl\u003e ./. /home/jr/src/nixpkgs nix-repl\u003e ./. + \"/lib\" /home/jr/src/nixpkgs/lib Nix does path normalization every time you append strings, so if you just add a slash / its not actually there:\nnix-repl\u003e ./. /home/jr/src/nixpkgs nix-repl\u003e ./. + \"/\" /home/jr/src/nixpkgs nix-repl\u003e ./. + \"/\" + \"lib\" /home/jr/src/nixpkgslib nix-repl\u003e \"${./.}/lib\" # using ${./.} causes a store copy copying '/homr/jr/src/nixpkgs' to the store \"/nix/store/3z9fzx8z03wslxvri5syv3jnnhn5fkbd-nixpkgs/lib\" nix-repl\u003e \"${toString ./.}/lib\" # using toString avoids making a store copy \"/home/jr/src/nixpkgs/lib\" nix-repl\u003e ./lib/.. # nix removes all `..` to avoid redundant path resolutions /home/jr/src/nixpkgs nix-repl\u003e :q realpath ./lib/.. /home/jr/src/nixpkgs ln -s pkgs/applications lib-symlink realpath ./lib-symlink/.. /home/jr/src/nixpkgs/pkgs nix repl nix-repl\u003e ./lib-symlink/.. # Nix doesn't read this file at all like realpath did /home/jr/src/nixpkgs nix-repl\u003e builtins.readDir ./. # listing of all entries in current dir and their types { \".devcontainer\" = \"directory\"; \".editorconfig\" = \"regular\"; \".git\" = \"directory\"; \".git-blame-ignore-revs\" = \"regular\"; \".gitattributes\" = \"regular\"; \".github\" = \"directory\"; \".gitignore\" = \"regular\"; \".mailmap\" = \"regular\"; \".mergify.yml\" = \"regular\"; \".version\" = \"symlink\"; \"CONTRIBUTING.md\" = \"regular\"; COPYING = \"regular\"; \"README.md\" = \"regular\"; ci = \"directory\"; \"default.nix\" = \"regular\"; doc = \"directory\"; \"flake.nix\" = \"regular\"; lib = \"directory\"; maintainers = \"directory\"; nixos = \"directory\"; pkgs = \"directory\"; \"shell.nix\" = \"regular\"; } nix-repl\u003e builtins.readFile ./default.nix \"let\\n requiredVersion = import ./lib/minver.nix;\\nin\\n\\nif !builtins ? nixVersion || builtins.compareVersions requiredVersion builtins.nixVersion == 1 then\\n\\n abort ''\\n\\n This version of Nixpkgs requires Nix \u003e= \\${requiredVersion}, please upgrade:\\n\\n - If you are running NixOS, `nixos-rebuild' can be used to upgrade your system.\\n\\n - Alternatively, with Nix \u003e 2.0 `nix upgrade-nix' can be used to imperatively\\n upgrade Nix. You may use `nix-env --version' to check which version you have.\\n\\n - If you installed Nix using the install script (https://nixos.org/nix/install),\\n it is safe to upgrade by running it again:\\n\\n curl -L https://nixos.org/nix/install | sh\\n\\n For more information, please see the NixOS release notes at\\n https://nixos.org/nixos/manual or locally at\\n \\${toString ./nixos/doc/manual/release-notes}.\\n\\n If you need further help, see https://nixos.org/nixos/support.html\\n ''\\n\\nelse\\n\\n import ./pkgs/top-level/impure.nix\\n\" nix-repl\u003e :l nix-repl\u003e importJSON ./pkgs/development/python-modules/notebook/missing-hashes.json # Return the nix value for JSON { \"@nx/nx-darwin-arm64@npm:16.10.0\" = \"aabcc8499602b98c9fc3b768fe46dfd4e1b818caa84b740bd4f73a2e4528c719b979ecb1c10a0d793a1fead83073a08bc86417588046aa3e587e80af880bffd3\"; \"@nx/nx-darwin-x64@npm:16.10.0\" = \"9dd20f45f646d05306f23f5abb7ade69dcb962e23a013101e93365847722079656d30a19c735fdcfa5c4e0fdf08691f9d621073c58aef2861c26741ff4638375\"; \"@nx/nx-freebsd-x64@npm:16.10.0\" = \"35b93aabe3b3274d53157a6fc10fec7e341e75e6818e96cfbc89c3d5b955d225ca80a173630b6aa43c448c6b53b23f06a2699a25c0c8bc71396ee20a023d035f\"; \"@nx/nx-linux-arm-gnueabihf@npm:16.10.0\" = \"697b9fa4c70f84d3ea8fe32d47635864f2e40b0ceeb1484126598c61851a2ec34b56bb3eeb9654c37d9b14e81ce85a36ac38946b4b90ca403c57fe448be51ccb\"; \"@nx/nx-linux-arm64-gnu@npm:16.10.0\" = \"001e71fedfc763a4dedd6c5901b66a4a790d388673fb74675235e19bb8fe031ff3755568ed867513dd003f873901fabda31a7d5628b39095535cb9f6d1dc7191\"; \"@nx/nx-linux-arm64-musl@npm:16.10.0\" = \"58e3b71571bdadd2b0ddd24ea6e30cd795e706ada69f685403412c518fba1a2011ac8c2ac46145eab14649aa5a78e0cedcdb4d327ccb3b6ec12e055171f3840b\"; \"@nx/nx-linux-x64-gnu@npm:16.10.0\" = \"97729a7efb27301a67ebf34739784114528ddb54047e63ca110a985eaa0763c5b1ea7c623ead1a2266d07107951be81e82ffa0a30e6e4d97506659303f2c8c78\"; \"@nx/nx-linux-x64-musl@npm:16.10.0\" = \"442bdbd5e61324a850e4e7bd6f54204108580299d3c7c4ebcec324da9a63e23f48d797a87593400fc32af78a3a03a3c104bfb360f107fe732e6a6c289863853a\"; \"@nx/nx-win32-arm64-msvc@npm:16.10.0\" = \"b5c74184ebfc70294e85f8e309f81c3d40b5cf99068891e613f3bef5ddb946bef7c9942d9e6c7688e22006d45d786342359af3b4fc87aadf369afcda55c73187\"; \"@nx/nx-win32-x64-msvc@npm:16.10.0\" = \"c5b174ebd7a5916246088e17d3761804b88f010b6b3f930034fa49af00da33b6d1352728c733024f736e4c2287def75bafdc3d60d8738bd24b67e9a4f11763f8\"; } nix-repl\u003e builtins.toJSON # serialize «primop toJSON» nix-repl\u003e builtins.fromTOML «primop fromTOML» nix-repl\u003e builtins.toXML For more serialization formats see nixpkgs/lib/generators.nix as well as in nixpkgs/pkgs/pkgs-lib/formats/ we can see them with the nix repl as follows:\ncd ~/src/nixpkgs nix repl nix-repl\u003e :l . nix-repl\u003e lib.generators.toYAML {} { a = 10; } \"{\\\"a\\\":10}\" nix-repl\u003e lib.generators.toYAML {} { a.b.c = 10; } \"{\\\"a\\\":{\\\"b\\\":{\\\"c\\\":10}}}\" nix-repl\u003e builtins.trace (lib.generators.toYAML {} { a.b.c = 10; }) null trace: {\"a\":{\"b\":{\"c\":10}}} null nix-repl\u003e yamlFormat = pkgs.formats.yaml {} nix-repl\u003e yamlFormat { generate = «lambda generate @ /home/jr/src/nixpkgs/pkgs/pkgs-lib/formats.nix:111:9»; type = { ... }; } We can see that it provides a generate function that we can use. generate doesn’t just generate a string anymore because if we want to lift the restriction at evaluation time we can’t return the formatted form at evaluation time anymore. We need a name to return a derivation continued below: yamlFormat.generate \"name\" { a.b.c = 10; } «derivation /nix/store/xakajb2rzbmqqkjbh08bxwqdf0xqvjly-name.drv» nix-repl\u003e :b yamlFormat.generate \"name\" { a.b.c = 10; } This derivation produced the following outputs: out -\u003e /nix/store/y4c5029k6w3l0qmdw7cq396zrdy5x8yj-name nix-repl\u003e :q Let’s cat the result to see if it’s formatted correctly as YAML:\ncat /nix/store/y4c5029k6w3l0qmdw7cq396zrdy5x8yj-name ───────┬─────────────────────────────────────────────────────────────── │ File: /nix/store/y4c5029k6w3l0qmdw7cq396zrdy5x8yj-name ───────┼────────────────────────────────────────────────────────────── 1 │ a: 2 │ b: 3 │ c: 10 ───────┴─────────────────────────────────────────────────────────── Looks good. There is also a type:\nnix repl nix-repl\u003e :l . nix-repl\u003e yamlFormat = pkgs.format.yaml {} nix-repl\u003e yamlFormat.type { _type = \"option-type\"; check = «lambda check @ /home/jr/src/nixpkgs/lib/types.nix:1029:19»; deprecationMessage = null; description = \"YAML value\"; descriptionClass = \"conjunction\"; emptyValue = { ... }; functor = { ... }; getSubModules = null; getSubOptions = «lambda @ /home/jr/src/nixpkgs/lib/types.nix:214:25»; merge = «lambda merge @ /home/jr/src/nixpkgs/lib/types.nix:1031:13»; name = \"nullOr\"; nestedTypes = { ... }; substSubModules = «lambda substSubModules @ /home/jr/src/nixpkgs/lib/types.nix:1046:29»; typeMerge = «lambda defaultTypeMerge @ /home/jr/src/nixpkgs/lib/types.nix:115:10»; } nix-repl\u003e lib.modules.mergeDefinitions [] yamlFormat.type [ { value = null; } ] { defsFinal = [ ... ]; defsFinal' = { ... }; isDefined = true; mergedValue = null; optionalValue = { ... }; } nix-repl\u003e (lib.modules.mergeDefinitions [] yamlFormat.type [ { value = null; } ]).mergedValue null nix-repl\u003e :p (lib.modules.mergeDefinitions [] yamlFormat.type [ { value = { a.b.c = 10; }; } ]).mergedValue { a = { b = { c = 10; }; }; } nix-repl\u003e :p (lib.modules.mergeDefinitions [] yamlFormat.type [ { value = { a.b.c = 10; }; } { value = { a.b.d = 20; }; } ]).mergedValue { a = { b = { c = 10; d = 20; }; }; } lib can’t access any packages, it is entirely at evaluation time. It can’t access any formatters or things like that. If we lift that restriction as is done in pkgs.formats we can make it look much nicer. cd ~/src/nixpkgs nix-build -A hello warning: Nix search path entry '/nix/var/nix/profiles/per-user/root/channels' does not exist, ignoring this path will be fetched (0.06 MiB download, 0.26 MiB unpacked): /nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2 copying path '/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2' from 'https://cache.nixos.org'... /nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2 Say we rely on this store path in a derivation:\nnix-repl\u003e thePath = \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2\" nix-repl\u003e thePath + \"/bin/hello\" \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello\" hx ~/src/nixpkgs/test2.nix # test2.nix with import ./. {}; runCommand \"test\" { nativeBuildInputs = [ hello ]; }'' hello \u003e $out '' Try building it:\nnix-build test2.nix \u0026\u0026 cat result warning: Nix search path entry '/nix/var/nix/profiles/per-user/root/channels' does not exist, ignoring /nix/store/m55p4vpb8s7s28s20vs89i467kxbrdac-test Hello, world! Now if we try it with the store path:\n# test2.nix with import ./. {}; runCommand \"test\" { }'' /nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello \u003e $out '' This doesn’t work\nnix-build test2.nix last 1 log lines: \u003e /build/.attr-0l2nkwhif96f51f4amnlf414lhl4rv9vh8iffyp431v6s28gsr90: line 1: /nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello: No such file or directory For full logs, run: nix log /nix/store/58zcp9xwgf1sirmzf9sh61j8gz9lkw34-test.drv nix-instantiate test2.nix /nix/store/58zcp9xwgf1sirmzf9sh61j8gz9lkw34-test.drv nix derivation show /nix/store/58zcp9xwgf1sirmzf9sh61j8gz9lkw34-test.drv | jq { \"/nix/store/58zcp9xwgf1sirmzf9sh61j8gz9lkw34-test.drv\": { \"args\": [ \"-e\", \"/nix/store/vj1c3wf9c11a0qs6p3ymfvrnsdgsdcbq-source-stdenv.sh\", \"/nix/store/shkw4qm9qcw5sc5n1k5jznc83ny02r39-default-builder.sh\" ], \"builder\": \"/nix/store/xy4jjgw87sbgwylm5kn047d9gkbhsr9x-bash-5.2p37/bin/bash\", \"env\": { \"__structuredAttrs\": \"\", \"buildCommand\": \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello \u003e $out\\n\", \"buildInputs\": \"\", \"builder\": \"/nix/store/xy4jjgw87sbgwylm5kn047d9gkbhsr9x-bash-5.2p37/bin/bash\", \"cmakeFlags\": \"\", \"configureFlags\": \"\", \"depsBuildBuild\": \"\", \"depsBuildBuildPropagated\": \"\", \"depsBuildTarget\": \"\", \"depsBuildTargetPropagated\": \"\", \"depsHostHost\": \"\", \"depsHostHostPropagated\": \"\", \"depsTargetTarget\": \"\", \"depsTargetTargetPropagated\": \"\", \"doCheck\": \"\", \"doInstallCheck\": \"\", \"enableParallelBuilding\": \"1\", \"enableParallelChecking\": \"1\", \"enableParallelInstalling\": \"1\", \"mesonFlags\": \"\", \"name\": \"test\", \"nativeBuildInputs\": \"\", \"out\": \"/nix/store/ljrkx5midby3j7p4g96d74jrq8f9rpya-test\", \"outputs\": \"out\", \"passAsFile\": \"buildCommand\", \"patches\": \"\", \"propagatedBuildInputs\": \"\", \"propagatedNativeBuildInputs\": \"\", \"stdenv\": \"/nix/store/aq801xbgs98nxx3lckrym06qfvl8mfsf-stdenv-linux\", \"strictDeps\": \"\", \"system\": \"x86_64-linux\" }, \"inputDrvs\": { \"/nix/store/bmncp7arkdhrl6nkyg0g420935x792gl-stdenv-linux.drv\": { \"dynamicOutputs\": {}, \"outputs\": [ \"out\" ] }, \"/nix/store/rfkzz952hz2d58d90mscxvk87v5wa5bz-bash-5.2p37.drv\": { \"dynamicOutputs\": {}, \"outputs\": [ \"out\" ] } }, \"inputSrcs\": [ \"/nix/store/shkw4qm9qcw5sc5n1k5jznc83ny02r39-default-builder.sh\", \"/nix/store/vj1c3wf9c11a0qs6p3ymfvrnsdgsdcbq-source-stdenv.sh\" ], \"name\": \"test\", \"outputs\": { \"out\": { \"path\": \"/nix/store/ljrkx5midby3j7p4g96d74jrq8f9rpya-test\" } }, \"system\": \"x86_64-linux\" } } You see the \"inputDrvs\", they are the derivations that we depend on and it doesn’t know about the hello.drv. In Nix for the builder sandbox it creates a sandbox that only contains the derivations that you depend on which ensures that you can’t depend on any derivation that you haven’t explicitly decalred.\nNix does have builtins.storePath that allows you to do this, otherwise it’s kind of an anti pattern.\n# test2.nix # test2.nix # test2.nix with import ./. {}; runCommand \"test\" { } '' ${builtins.storePath \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2\"}/bin/hello \u003e $out '' builtins.storePath: Turns a store path into the thing that it represents in the store.\nnix-build test2.nix \u0026\u0026 cat result /nix/store/x48741w0k9hgqywzv6wc7rk90r1y75js-test Hello, world! To demonstrate what builtins.storePath does:\nnix-repl\u003e builtins.storePath \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello\" \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello\" nix-repl\u003e builtins.getContext \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2\" { } nix-repl\u003e builtins.getContext (builtins.storePath \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2\") { \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2\" = { ... }; } nix-repl\u003e :p builtins.getContext (builtins.storePath \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2\") { \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2\" = { path = true; }; } nix-repl\u003e :l . warning: Nix search path entry '/nix/var/nix/profiles/per-user/root/channels' does not exist, ignoring Added 24878 variables. nix-repl\u003e hello.outPath # this is the output path of the hello derivation \"/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2\" nix-repl\u003e :p builtins.getContext hello.outPath # we see that this is a `.drv`, this is because derivations can have multiple outputs { \"/nix/store/ljxsxdy1syy03b9kfnnh8x7zsk21fdcq-hello-2.12.2.drv\" = { outputs = [ \"out\" ]; }; } # for example nix-repl\u003e openssl.outputs [ \"bin\" \"dev\" \"out\" \"man\" \"doc\" \"debug\" ] nix-repl\u003e openssl.all # a list of all the derivations [ «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv» «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv» «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv» «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv» «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv» «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv» ] nix-repl\u003e lib.concatStringsSep \" \" openssl.all \"/nix/store/rjzx8v679rwd6dsb6s08iy3j2rrax72s-openssl-3.4.1-bin /nix/store/kcgqglb4iax0zh5jlrxmjdik93wlgsrq-openssl-3.4.1-dev /nix/store/8pviily4fgsl02ijm65binz236717wfs-openssl-3.4.1 /nix/store/1l5b31cnswnbcdcac9rzs9xixnc2n9r5-openssl-3.4.1-man /nix/store/9fz5qmj0z70cbzy7mapml0sbi8z6ap0a-openssl-3.4.1-doc /nix/store/yk2g2gfcj2fy1ffyi1g91q7jmp4h8pxa-openssl-3.4.1-debug\" nix-repl\u003e :p builtins.getContext (builtins.unsafeDiscardOutputDependency (lib.concatStringsSep \" \" openssl.all)) { \"/nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv\" = { outputs = [ \"bin\" \"debug\" \"dev\" \"doc\" \"man\" \"out\" ]; }; } nix-repl\u003e :p builtins.getContext openssl.drvPath { \"/nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv\" = { allOutputs = true; }; } # useful if you need to create a derivation that copies this derivation to another machine # remote builders usually take care of this but you may need it occasionally nix-repl\u003e :p builtins.getContext (builtins.unsafeDiscardOutputDependency openssl.drvPath) { \"/nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv\" = { path = true; }; } Relying on paths outside of the nix store is generally not recommended because of garbage collection and it’s considered unsafe.\n","wordCount":"1462","inLanguage":"en","datePublished":"2025-06-15T18:21:05-04:00","dateModified":"2025-06-15T18:21:05-04:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://tsawyer87.github.io/posts/nix_paths/"},"publisher":{"@type":"Organization","name":"NixOS Blog","logo":{"@type":"ImageObject","url":"https://tsawyer87.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tsawyer87.github.io/ accesskey=h title="NixOS Blog (Alt + H)">NixOS Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
<a href=/index.xml title="RSS Feed"><img src=/images/rss.png alt="RSS Feed" style=width:24px;height:24px></a></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Nix_paths</h1><div class=post-meta><span title='2025-06-15 18:21:05 -0400 EDT'>June 15, 2025</span></div></header><div class=post-content><h1 id=nix-paths>Nix Paths<a hidden class=anchor aria-hidden=true href=#nix-paths>#</a></h1><p>The following examples are done with a local <code>nixpkgs</code> clone located at
<code>~/src/nixpkgs</code></p><p>Paths in Nix always need a <code>/</code> in them and always expand to absolute paths
relative to your current directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix repl
</span></span><span style=display:flex><span>nix-repl&gt; ./.
</span></span><span style=display:flex><span>/home/jr/src/nixpkgs
</span></span><span style=display:flex><span>nix-repl&gt; ./. + <span style=color:#e6db74>&#34;/lib&#34;</span>
</span></span><span style=display:flex><span>/home/jr/src/nixpkgs/lib
</span></span></code></pre></div><p>Nix does <em>path normalization</em> every time you append strings, so if you just add
a slash <code>/</code> its not actually there:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-repl&gt; ./.
</span></span><span style=display:flex><span>/home/jr/src/nixpkgs
</span></span><span style=display:flex><span>nix-repl&gt; ./. + <span style=color:#e6db74>&#34;/&#34;</span>
</span></span><span style=display:flex><span>/home/jr/src/nixpkgs
</span></span><span style=display:flex><span>nix-repl&gt; ./. + <span style=color:#e6db74>&#34;/&#34;</span> + <span style=color:#e6db74>&#34;lib&#34;</span>
</span></span><span style=display:flex><span>/home/jr/src/nixpkgslib
</span></span><span style=display:flex><span>nix-repl&gt; <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>./.<span style=color:#e6db74>}</span><span style=color:#e6db74>/lib&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># using ${./.} causes a store copy</span>
</span></span><span style=display:flex><span>copying <span style=color:#e6db74>&#39;/homr/jr/src/nixpkgs&#39;</span> to the store
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;/nix/store/3z9fzx8z03wslxvri5syv3jnnhn5fkbd-nixpkgs/lib&#34;</span>
</span></span><span style=display:flex><span>nix-repl&gt; <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>toString ./.<span style=color:#e6db74>}</span><span style=color:#e6db74>/lib&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># using toString avoids making a store copy</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;/home/jr/src/nixpkgs/lib&#34;</span>
</span></span><span style=display:flex><span>nix-repl&gt; ./lib/..             <span style=color:#75715e># nix removes all `..` to avoid redundant path resolutions</span>
</span></span><span style=display:flex><span>/home/jr/src/nixpkgs
</span></span><span style=display:flex><span>nix-repl&gt; :q
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>realpath ./lib/..
</span></span><span style=display:flex><span>/home/jr/src/nixpkgs
</span></span><span style=display:flex><span>ln -s pkgs/applications lib-symlink
</span></span><span style=display:flex><span>realpath ./lib-symlink/..
</span></span><span style=display:flex><span>/home/jr/src/nixpkgs/pkgs
</span></span><span style=display:flex><span>nix repl
</span></span><span style=display:flex><span>nix-repl&gt; ./lib-symlink/..   <span style=color:#75715e># Nix doesn&#39;t read this file at all like realpath did</span>
</span></span><span style=display:flex><span>/home/jr/src/nixpkgs
</span></span><span style=display:flex><span>nix-repl&gt; builtins.readDir ./. <span style=color:#75715e># listing of all entries in current dir and their types</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;.devcontainer&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;directory&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;.editorconfig&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;.git&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;directory&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;.git-blame-ignore-revs&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;.gitattributes&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;.github&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;directory&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;.gitignore&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;.mailmap&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;.mergify.yml&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;.version&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;symlink&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;CONTRIBUTING.md&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span>  COPYING <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;README.md&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span>  ci <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;directory&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;default.nix&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span>  doc <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;directory&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;flake.nix&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span>  lib <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;directory&#34;</span>;
</span></span><span style=display:flex><span>  maintainers <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;directory&#34;</span>;
</span></span><span style=display:flex><span>  nixos <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;directory&#34;</span>;
</span></span><span style=display:flex><span>  pkgs <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;directory&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shell.nix&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;regular&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>nix-repl&gt; builtins.readFile ./default.nix
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;let\n  requiredVersion = import ./lib/minver.nix;\nin\n\nif !builtins ? nixVersion
</span></span></span><span style=display:flex><span><span style=color:#e6db74> || builtins.compareVersions requiredVersion builtins.nixVersion == 1 then\n\n  abort
</span></span></span><span style=display:flex><span><span style=color:#e6db74> &#39;&#39;\n\n    This version of Nixpkgs requires Nix &gt;= \${requiredVersion}, please
</span></span></span><span style=display:flex><span><span style=color:#e6db74> upgrade:\n\n    - If you are running NixOS, `nixos-rebuild&#39; can be used to upgrade
</span></span></span><span style=display:flex><span><span style=color:#e6db74> your system.\n\n    - Alternatively, with Nix &gt; 2.0 `nix upgrade-nix&#39; can be used
</span></span></span><span style=display:flex><span><span style=color:#e6db74> to imperatively\n      upgrade Nix. You may use `nix-env --version&#39; to check which
</span></span></span><span style=display:flex><span><span style=color:#e6db74> version you have.\n\n    - If you installed Nix using the install script (https://nixos.org/nix/install),\n
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  it is safe to upgrade by running it again:\n\n          curl -L https://nixos.org/nix/install | sh\n\n
</span></span></span><span style=display:flex><span><span style=color:#e6db74>For more information, please see the NixOS release notes at\n    https://nixos.org/nixos/manual
</span></span></span><span style=display:flex><span><span style=color:#e6db74> or locally at\n    \${toString ./nixos/doc/manual/release-notes}.\n\n    If you need further help,
</span></span></span><span style=display:flex><span><span style=color:#e6db74> see https://nixos.org/nixos/support.html\n  &#39;&#39;\n\nelse\n\n  import ./pkgs/top-level/impure.nix\n&#34;</span>
</span></span><span style=display:flex><span>nix-repl&gt; :l &lt;nixpkgs/lib&gt;
</span></span><span style=display:flex><span>nix-repl&gt; importJSON ./pkgs/development/python-modules/notebook/missing-hashes.json <span style=color:#75715e># Return the nix value for JSON</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;@nx/nx-darwin-arm64@npm:16.10.0&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;aabcc8499602b98c9fc3b768fe46dfd4e1b818caa84b740bd4f73a2e4528c719b979ecb1c10a0d793a1fead83073a08bc86417588046aa3e587e80af880bffd3&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;@nx/nx-darwin-x64@npm:16.10.0&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;9dd20f45f646d05306f23f5abb7ade69dcb962e23a013101e93365847722079656d30a19c735fdcfa5c4e0fdf08691f9d621073c58aef2861c26741ff4638375&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;@nx/nx-freebsd-x64@npm:16.10.0&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;35b93aabe3b3274d53157a6fc10fec7e341e75e6818e96cfbc89c3d5b955d225ca80a173630b6aa43c448c6b53b23f06a2699a25c0c8bc71396ee20a023d035f&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;@nx/nx-linux-arm-gnueabihf@npm:16.10.0&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;697b9fa4c70f84d3ea8fe32d47635864f2e40b0ceeb1484126598c61851a2ec34b56bb3eeb9654c37d9b14e81ce85a36ac38946b4b90ca403c57fe448be51ccb&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;@nx/nx-linux-arm64-gnu@npm:16.10.0&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;001e71fedfc763a4dedd6c5901b66a4a790d388673fb74675235e19bb8fe031ff3755568ed867513dd003f873901fabda31a7d5628b39095535cb9f6d1dc7191&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;@nx/nx-linux-arm64-musl@npm:16.10.0&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;58e3b71571bdadd2b0ddd24ea6e30cd795e706ada69f685403412c518fba1a2011ac8c2ac46145eab14649aa5a78e0cedcdb4d327ccb3b6ec12e055171f3840b&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;@nx/nx-linux-x64-gnu@npm:16.10.0&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;97729a7efb27301a67ebf34739784114528ddb54047e63ca110a985eaa0763c5b1ea7c623ead1a2266d07107951be81e82ffa0a30e6e4d97506659303f2c8c78&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;@nx/nx-linux-x64-musl@npm:16.10.0&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;442bdbd5e61324a850e4e7bd6f54204108580299d3c7c4ebcec324da9a63e23f48d797a87593400fc32af78a3a03a3c104bfb360f107fe732e6a6c289863853a&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;@nx/nx-win32-arm64-msvc@npm:16.10.0&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;b5c74184ebfc70294e85f8e309f81c3d40b5cf99068891e613f3bef5ddb946bef7c9942d9e6c7688e22006d45d786342359af3b4fc87aadf369afcda55c73187&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;@nx/nx-win32-x64-msvc@npm:16.10.0&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;c5b174ebd7a5916246088e17d3761804b88f010b6b3f930034fa49af00da33b6d1352728c733024f736e4c2287def75bafdc3d60d8738bd24b67e9a4f11763f8&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>nix-repl&gt; builtins.toJSON  <span style=color:#75715e># serialize</span>
</span></span><span style=display:flex><span>«primop toJSON»
</span></span><span style=display:flex><span>nix-repl&gt; builtins.fromTOML
</span></span><span style=display:flex><span>«primop fromTOML»
</span></span><span style=display:flex><span>nix-repl&gt; builtins.toXML
</span></span></code></pre></div><p>For more serialization formats see <code>nixpkgs/lib/generators.nix</code> as well as in
<code>nixpkgs/pkgs/pkgs-lib/formats/</code> we can see them with the <code>nix repl</code> as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd ~/src/nixpkgs
</span></span><span style=display:flex><span>nix repl
</span></span><span style=display:flex><span>nix-repl&gt; :l .
</span></span><span style=display:flex><span>nix-repl&gt; lib.generators.toYAML <span style=color:#f92672>{}</span> <span style=color:#f92672>{</span> a <span style=color:#f92672>=</span> 10; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;{\&#34;a\&#34;:10}&#34;</span>
</span></span><span style=display:flex><span>nix-repl&gt; lib.generators.toYAML <span style=color:#f92672>{}</span> <span style=color:#f92672>{</span> a.b.c <span style=color:#f92672>=</span> 10; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;{\&#34;a\&#34;:{\&#34;b\&#34;:{\&#34;c\&#34;:10}}}&#34;</span>
</span></span><span style=display:flex><span>nix-repl&gt; builtins.trace <span style=color:#f92672>(</span>lib.generators.toYAML <span style=color:#f92672>{}</span> <span style=color:#f92672>{</span> a.b.c <span style=color:#f92672>=</span> 10; <span style=color:#f92672>})</span> null
</span></span><span style=display:flex><span>trace: <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;a&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;b&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;c&#34;</span>:10<span style=color:#f92672>}}}</span>
</span></span><span style=display:flex><span>null
</span></span><span style=display:flex><span>nix-repl&gt; yamlFormat <span style=color:#f92672>=</span> pkgs.formats.yaml <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nix-repl&gt; yamlFormat
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  generate <span style=color:#f92672>=</span> «lambda generate @ /home/jr/src/nixpkgs/pkgs/pkgs-lib/formats.nix:111:9»;
</span></span><span style=display:flex><span>  type <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> ... <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>We can see that it provides a <code>generate</code> function that we can use. <code>generate</code>
doesn&rsquo;t just generate a string anymore because if we want to lift the
restriction at evaluation time we can&rsquo;t return the formatted form at
evaluation time anymore. We need a name to return a derivation continued
below:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yamlFormat.generate <span style=color:#e6db74>&#34;name&#34;</span> <span style=color:#f92672>{</span> a.b.c <span style=color:#f92672>=</span> 10; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>«derivation /nix/store/xakajb2rzbmqqkjbh08bxwqdf0xqvjly-name.drv»
</span></span><span style=display:flex><span>nix-repl&gt; :b yamlFormat.generate <span style=color:#e6db74>&#34;name&#34;</span> <span style=color:#f92672>{</span> a.b.c <span style=color:#f92672>=</span> 10; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>This derivation produced the following outputs:
</span></span><span style=display:flex><span>out -&gt; /nix/store/y4c5029k6w3l0qmdw7cq396zrdy5x8yj-name
</span></span><span style=display:flex><span>nix-repl&gt; :q
</span></span></code></pre></div><p>Let&rsquo;s cat the result to see if it&rsquo;s formatted correctly as YAML:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat /nix/store/y4c5029k6w3l0qmdw7cq396zrdy5x8yj-name
</span></span><span style=display:flex><span>───────┬───────────────────────────────────────────────────────────────
</span></span><span style=display:flex><span>       │ File: /nix/store/y4c5029k6w3l0qmdw7cq396zrdy5x8yj-name
</span></span><span style=display:flex><span>───────┼──────────────────────────────────────────────────────────────
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>1</span>   │ a:
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>2</span>   │   b:
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>3</span>   │     c: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>───────┴───────────────────────────────────────────────────────────
</span></span></code></pre></div><p>Looks good. There is also a <code>type</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix repl
</span></span><span style=display:flex><span>nix-repl&gt; :l .
</span></span><span style=display:flex><span>nix-repl&gt; yamlFormat <span style=color:#f92672>=</span> pkgs.format.yaml <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>nix-repl&gt; yamlFormat.type
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  _type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;option-type&#34;</span>;
</span></span><span style=display:flex><span>  check <span style=color:#f92672>=</span> «lambda check @ /home/jr/src/nixpkgs/lib/types.nix:1029:19»;
</span></span><span style=display:flex><span>  deprecationMessage <span style=color:#f92672>=</span> null;
</span></span><span style=display:flex><span>  description <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;YAML value&#34;</span>;
</span></span><span style=display:flex><span>  descriptionClass <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;conjunction&#34;</span>;
</span></span><span style=display:flex><span>  emptyValue <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> ... <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span>  functor <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> ... <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span>  getSubModules <span style=color:#f92672>=</span> null;
</span></span><span style=display:flex><span>  getSubOptions <span style=color:#f92672>=</span> «lambda @ /home/jr/src/nixpkgs/lib/types.nix:214:25»;
</span></span><span style=display:flex><span>  merge <span style=color:#f92672>=</span> «lambda merge @ /home/jr/src/nixpkgs/lib/types.nix:1031:13»;
</span></span><span style=display:flex><span>  name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;nullOr&#34;</span>;
</span></span><span style=display:flex><span>  nestedTypes <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> ... <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span>  substSubModules <span style=color:#f92672>=</span> «lambda substSubModules @ /home/jr/src/nixpkgs/lib/types.nix:1046:29»;
</span></span><span style=display:flex><span>  typeMerge <span style=color:#f92672>=</span> «lambda defaultTypeMerge @ /home/jr/src/nixpkgs/lib/types.nix:115:10»;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>nix-repl&gt; lib.modules.mergeDefinitions <span style=color:#f92672>[]</span> yamlFormat.type <span style=color:#f92672>[</span> <span style=color:#f92672>{</span> value <span style=color:#f92672>=</span> null; <span style=color:#f92672>}</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  defsFinal <span style=color:#f92672>=</span> <span style=color:#f92672>[</span> ... <span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>  defsFinal<span style=color:#960050;background-color:#1e0010>&#39;</span> <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> ... <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span>  isDefined <span style=color:#f92672>=</span> true;
</span></span><span style=display:flex><span>  mergedValue <span style=color:#f92672>=</span> null;
</span></span><span style=display:flex><span>  optionalValue <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> ... <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>nix-repl&gt; <span style=color:#f92672>(</span>lib.modules.mergeDefinitions <span style=color:#f92672>[]</span> yamlFormat.type <span style=color:#f92672>[</span> <span style=color:#f92672>{</span> value <span style=color:#f92672>=</span> null; <span style=color:#f92672>}</span> <span style=color:#f92672>])</span>.mergedValue
</span></span><span style=display:flex><span>null
</span></span><span style=display:flex><span>nix-repl&gt; :p <span style=color:#f92672>(</span>lib.modules.mergeDefinitions <span style=color:#f92672>[]</span> yamlFormat.type <span style=color:#f92672>[</span> <span style=color:#f92672>{</span> value <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> a.b.c <span style=color:#f92672>=</span> 10; <span style=color:#f92672>}</span>; <span style=color:#f92672>}</span> <span style=color:#f92672>])</span>.mergedValue
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  a <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    b <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> c <span style=color:#f92672>=</span> 10; <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>nix-repl&gt; :p <span style=color:#f92672>(</span>lib.modules.mergeDefinitions <span style=color:#f92672>[]</span> yamlFormat.type <span style=color:#f92672>[</span> <span style=color:#f92672>{</span> value <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> a.b.c <span style=color:#f92672>=</span> 10; <span style=color:#f92672>}</span>; <span style=color:#f92672>}</span> <span style=color:#f92672>{</span> value <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> a.b.d <span style=color:#f92672>=</span> 20; <span style=color:#f92672>}</span>; <span style=color:#f92672>}</span> <span style=color:#f92672>])</span>.mergedValue
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  a <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    b <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      c <span style=color:#f92672>=</span> 10;
</span></span><span style=display:flex><span>      d <span style=color:#f92672>=</span> 20;
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li><code>lib</code> can&rsquo;t access any packages, it is entirely at evaluation time. It can&rsquo;t
access any formatters or things like that. If we lift that restriction as is
done in <code>pkgs.formats</code> we can make it look much nicer.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd ~/src/nixpkgs
</span></span><span style=display:flex><span>nix-build -A hello
</span></span><span style=display:flex><span>warning: Nix search path entry <span style=color:#e6db74>&#39;/nix/var/nix/profiles/per-user/root/channels&#39;</span> does not exist, ignoring
</span></span><span style=display:flex><span>this path will be fetched <span style=color:#f92672>(</span>0.06 MiB download, 0.26 MiB unpacked<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>  /nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2
</span></span><span style=display:flex><span>copying path <span style=color:#e6db74>&#39;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2&#39;</span> from <span style=color:#e6db74>&#39;https://cache.nixos.org&#39;</span>...
</span></span><span style=display:flex><span>/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2
</span></span></code></pre></div><p>Say we rely on this store path in a derivation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-repl&gt; thePath <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2&#34;</span>
</span></span><span style=display:flex><span>nix-repl&gt; thePath + <span style=color:#e6db74>&#34;/bin/hello&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hx ~/src/nixpkgs/test2.nix
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># test2.nix</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> <span style=color:#f92672>import</span> <span style=color:#e6db74>./.</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>runCommand <span style=color:#e6db74>&#34;test&#34;</span> {
</span></span><span style=display:flex><span>    nativeBuildInputs <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>        hello
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>}<span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  hello &gt; $out
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;</span>
</span></span></code></pre></div><p>Try building it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build test2.nix <span style=color:#f92672>&amp;&amp;</span> cat result
</span></span><span style=display:flex><span>warning: Nix search path entry <span style=color:#e6db74>&#39;/nix/var/nix/profiles/per-user/root/channels&#39;</span> does not exist, ignoring
</span></span><span style=display:flex><span>/nix/store/m55p4vpb8s7s28s20vs89i467kxbrdac-test
</span></span><span style=display:flex><span>Hello, world!
</span></span></code></pre></div><p>Now if we try it with the store path:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># test2.nix</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> <span style=color:#f92672>import</span> <span style=color:#e6db74>./.</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>runCommand <span style=color:#e6db74>&#34;test&#34;</span> {
</span></span><span style=display:flex><span>}<span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  /nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello &gt; $out
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;</span>
</span></span></code></pre></div><p>This doesn&rsquo;t work</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build test2.nix
</span></span><span style=display:flex><span>last <span style=color:#ae81ff>1</span> log lines:
</span></span><span style=display:flex><span>&gt; /build/.attr-0l2nkwhif96f51f4amnlf414lhl4rv9vh8iffyp431v6s28gsr90: line 1: /nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello: No such file or directory
</span></span><span style=display:flex><span>For full logs, run:
</span></span><span style=display:flex><span>nix log /nix/store/58zcp9xwgf1sirmzf9sh61j8gz9lkw34-test.drv
</span></span><span style=display:flex><span>nix-instantiate test2.nix
</span></span><span style=display:flex><span>/nix/store/58zcp9xwgf1sirmzf9sh61j8gz9lkw34-test.drv
</span></span><span style=display:flex><span>nix derivation show /nix/store/58zcp9xwgf1sirmzf9sh61j8gz9lkw34-test.drv | jq
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/nix/store/58zcp9xwgf1sirmzf9sh61j8gz9lkw34-test.drv&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;args&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;-e&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;/nix/store/vj1c3wf9c11a0qs6p3ymfvrnsdgsdcbq-source-stdenv.sh&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;/nix/store/shkw4qm9qcw5sc5n1k5jznc83ny02r39-default-builder.sh&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;builder&#34;</span>: <span style=color:#e6db74>&#34;/nix/store/xy4jjgw87sbgwylm5kn047d9gkbhsr9x-bash-5.2p37/bin/bash&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;env&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;__structuredAttrs&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;buildCommand&#34;</span>: <span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello &gt; </span>$out<span style=color:#e6db74>\n&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;buildInputs&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;builder&#34;</span>: <span style=color:#e6db74>&#34;/nix/store/xy4jjgw87sbgwylm5kn047d9gkbhsr9x-bash-5.2p37/bin/bash&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;cmakeFlags&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;configureFlags&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;depsBuildBuild&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;depsBuildBuildPropagated&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;depsBuildTarget&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;depsBuildTargetPropagated&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;depsHostHost&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;depsHostHostPropagated&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;depsTargetTarget&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;depsTargetTargetPropagated&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;doCheck&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;doInstallCheck&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;enableParallelBuilding&#34;</span>: <span style=color:#e6db74>&#34;1&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;enableParallelChecking&#34;</span>: <span style=color:#e6db74>&#34;1&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;enableParallelInstalling&#34;</span>: <span style=color:#e6db74>&#34;1&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;mesonFlags&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;test&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;nativeBuildInputs&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;out&#34;</span>: <span style=color:#e6db74>&#34;/nix/store/ljrkx5midby3j7p4g96d74jrq8f9rpya-test&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;outputs&#34;</span>: <span style=color:#e6db74>&#34;out&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;passAsFile&#34;</span>: <span style=color:#e6db74>&#34;buildCommand&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;patches&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;propagatedBuildInputs&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;propagatedNativeBuildInputs&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;stdenv&#34;</span>: <span style=color:#e6db74>&#34;/nix/store/aq801xbgs98nxx3lckrym06qfvl8mfsf-stdenv-linux&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;strictDeps&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;system&#34;</span>: <span style=color:#e6db74>&#34;x86_64-linux&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;inputDrvs&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;/nix/store/bmncp7arkdhrl6nkyg0g420935x792gl-stdenv-linux.drv&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;dynamicOutputs&#34;</span>: <span style=color:#f92672>{}</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;outputs&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;out&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;/nix/store/rfkzz952hz2d58d90mscxvk87v5wa5bz-bash-5.2p37.drv&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;dynamicOutputs&#34;</span>: <span style=color:#f92672>{}</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;outputs&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;out&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;inputSrcs&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;/nix/store/shkw4qm9qcw5sc5n1k5jznc83ny02r39-default-builder.sh&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;/nix/store/vj1c3wf9c11a0qs6p3ymfvrnsdgsdcbq-source-stdenv.sh&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;test&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;outputs&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;out&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;path&#34;</span>: <span style=color:#e6db74>&#34;/nix/store/ljrkx5midby3j7p4g96d74jrq8f9rpya-test&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;system&#34;</span>: <span style=color:#e6db74>&#34;x86_64-linux&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>You see the <code>"inputDrvs"</code>, they are the derivations that we depend on and it
doesn&rsquo;t know about the <code>hello.drv</code>. In Nix for the builder sandbox it creates a
sandbox that only contains the derivations that you depend on which ensures that
you can&rsquo;t depend on any derivation that you haven&rsquo;t explicitly decalred.</p><p>Nix does have <code>builtins.storePath</code> that allows you to do this, otherwise it&rsquo;s
kind of an anti pattern.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#75715e># test2.nix</span>
</span></span><span style=display:flex><span><span style=color:#75715e># test2.nix</span>
</span></span><span style=display:flex><span><span style=color:#75715e># test2.nix</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> <span style=color:#f92672>import</span> <span style=color:#e6db74>./.</span> {};
</span></span><span style=display:flex><span>  runCommand <span style=color:#e6db74>&#34;test&#34;</span> {
</span></span><span style=display:flex><span>  } <span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    </span><span style=color:#e6db74>${</span>builtins<span style=color:#f92672>.</span>storePath <span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2&#34;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/hello &gt; $out
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;&#39;</span>
</span></span></code></pre></div><p><code>builtins.storePath</code>: Turns a store path into the thing that it represents in
the store.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-build test2.nix <span style=color:#f92672>&amp;&amp;</span> cat result
</span></span><span style=display:flex><span>/nix/store/x48741w0k9hgqywzv6wc7rk90r1y75js-test
</span></span><span style=display:flex><span>Hello, world!
</span></span></code></pre></div><p>To demonstrate what <code>builtins.storePath</code> does:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-repl&gt; builtins.storePath <span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2/bin/hello&#34;</span>
</span></span><span style=display:flex><span>nix-repl&gt; builtins.getContext <span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>nix-repl&gt; builtins.getContext <span style=color:#f92672>(</span>builtins.storePath <span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2&#34;</span> <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> ... <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>nix-repl&gt; :p builtins.getContext <span style=color:#f92672>(</span>builtins.storePath <span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2&#34;</span> <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> path <span style=color:#f92672>=</span> true; <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nix-repl&gt; :l .
</span></span><span style=display:flex><span>warning: Nix search path entry <span style=color:#e6db74>&#39;/nix/var/nix/profiles/per-user/root/channels&#39;</span> does not exist, ignoring
</span></span><span style=display:flex><span>Added <span style=color:#ae81ff>24878</span> variables.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nix-repl&gt; hello.outPath
</span></span><span style=display:flex><span><span style=color:#75715e># this is the output path of the hello derivation</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;/nix/store/29mhfr5g4dsv07d80b7n4bgs45syk3wl-hello-2.12.2&#34;</span>
</span></span><span style=display:flex><span>nix-repl&gt; :p builtins.getContext hello.outPath
</span></span><span style=display:flex><span><span style=color:#75715e># we see that this is a `.drv`, this is because derivations can have multiple outputs</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/nix/store/ljxsxdy1syy03b9kfnnh8x7zsk21fdcq-hello-2.12.2.drv&#34;</span> <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    outputs <span style=color:#f92672>=</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;out&#34;</span> <span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e># for example</span>
</span></span><span style=display:flex><span>nix-repl&gt; openssl.outputs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;bin&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;dev&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;out&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;man&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;doc&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;debug&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>nix-repl&gt; openssl.all
</span></span><span style=display:flex><span><span style=color:#75715e># a list of all the derivations</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>  «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv»
</span></span><span style=display:flex><span>  «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv»
</span></span><span style=display:flex><span>  «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv»
</span></span><span style=display:flex><span>  «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv»
</span></span><span style=display:flex><span>  «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv»
</span></span><span style=display:flex><span>  «derivation /nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv»
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>nix-repl&gt; lib.concatStringsSep <span style=color:#e6db74>&#34; &#34;</span> openssl.all
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;/nix/store/rjzx8v679rwd6dsb6s08iy3j2rrax72s-openssl-3.4.1-bin /nix/store/kcgqglb4iax0zh5jlrxmjdik93wlgsrq-openssl-3.4.1-dev /nix/store/8pviily4fgsl02ijm65binz236717wfs-openssl-3.4.1 /nix/store/1l5b31cnswnbcdcac9rzs9xixnc2n9r5-openssl-3.4.1-man /nix/store/9fz5qmj0z70cbzy7mapml0sbi8z6ap0a-openssl-3.4.1-doc /nix/store/yk2g2gfcj2fy1ffyi1g91q7jmp4h8pxa-openssl-3.4.1-debug&#34;</span>
</span></span><span style=display:flex><span>nix-repl&gt; :p builtins.getContext <span style=color:#f92672>(</span>builtins.unsafeDiscardOutputDependency <span style=color:#f92672>(</span>lib.concatStringsSep <span style=color:#e6db74>&#34; &#34;</span> openssl.all<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv&#34;</span> <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    outputs <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;bin&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;debug&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;dev&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;doc&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;man&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;out&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>nix-repl&gt; :p builtins.getContext openssl.drvPath
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv&#34;</span> <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> allOutputs <span style=color:#f92672>=</span> true; <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e># useful if you need to create a derivation that copies this derivation to another machine</span>
</span></span><span style=display:flex><span><span style=color:#75715e># remote builders usually take care of this but you may need it occasionally</span>
</span></span><span style=display:flex><span>nix-repl&gt; :p builtins.getContext <span style=color:#f92672>(</span>builtins.unsafeDiscardOutputDependency openssl.drvPath<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;/nix/store/rw3y8k94ib37dc86n0wivr551wyzxgsk-openssl-3.4.1.drv&#34;</span> <span style=color:#f92672>=</span> <span style=color:#f92672>{</span> path <span style=color:#f92672>=</span> true; <span style=color:#f92672>}</span>;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Relying on paths outside of the nix store is generally not recommended because
of garbage collection and it&rsquo;s considered unsafe.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tsawyer87.github.io/>NixOS Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>