<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Comparing_flakes_to_traditional_nix | NixOS Blog</title>
<meta name="keywords" content="">
<meta name="description" content="Introduction: Flakes and Traditional Nix

     



This post is based on notes from Nix-Hour #4, comparing Traditional Nix and Flakes, focusing on achieving pure build results. See the YouTube video for the original content. This guide adapts the information for clarity and ease of understanding.

What is Purity in Nix?


A key benefit of Nix Flakes is their default enforcement of pure evaluation.


In Nix, an impure operation depends on something outside its explicit inputs. Examples include:">
<meta name="author" content="T Sawyer">
<link rel="canonical" href="http://localhost:1313/posts/comparing_flakes_to_traditional_nix/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/comparing_flakes_to_traditional_nix/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="NixOS Blog (Alt + H)">NixOS Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Comparing_flakes_to_traditional_nix
    </h1>
    <div class="post-meta"><span title='2025-05-14 19:27:18 -0400 EDT'>May 14, 2025</span>&nbsp;·&nbsp;T Sawyer

</div>
  </header> 
  <div class="post-content"><h1 id="introduction-flakes-and-traditional-nix">Introduction: Flakes and Traditional Nix<a hidden class="anchor" aria-hidden="true" href="#introduction-flakes-and-traditional-nix">#</a></h1>
<figure>
    <img loading="lazy" src="/images/nixWinter.png"
         alt="nix winter" width="1000"/> 
</figure>

<ul>
<li>This post is based on notes from Nix-Hour #4, comparing Traditional Nix and Flakes, focusing on achieving pure build results. See the <a href="https://www.youtube.com/watch?v=atmoYyBAhF4">YouTube video</a> for the original content. This guide adapts the information for clarity and ease of understanding.</li>
</ul>
<h2 id="what-is-purity-in-nix">What is Purity in Nix?<a hidden class="anchor" aria-hidden="true" href="#what-is-purity-in-nix">#</a></h2>
<ul>
<li>
<p>A key benefit of Nix Flakes is their <em>default</em> enforcement of <strong>pure evaluation</strong>.</p>
</li>
<li>
<p>In Nix, an <strong>impure operation</strong> depends on something <em>outside</em> its explicit inputs. Examples include:</p>
<ul>
<li>User&rsquo;s system configuration</li>
<li>Environment variables</li>
<li>Current time</li>
</ul>
</li>
<li>
<p>Impurity leads to unpredictable builds that may differ across systems or time.</p>
</li>
</ul>
<h2 id="building-a-simple-hello-package-flakes-vs-traditional-nix">Building a Simple &ldquo;hello&rdquo; Package: Flakes vs. Traditional Nix<a hidden class="anchor" aria-hidden="true" href="#building-a-simple-hello-package-flakes-vs-traditional-nix">#</a></h2>
<ul>
<li>We&rsquo;ll demonstrate building a basic &ldquo;hello&rdquo; package using both Flakes and Traditional Nix to highlight the differences in handling purity.</li>
</ul>
<h2 id="using-nix-flakes">Using Nix Flakes<a hidden class="anchor" aria-hidden="true" href="#using-nix-flakes">#</a></h2>
<ol>
<li>
<p><strong>Setup:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir hello <span style="color:#f92672">&amp;&amp;</span> cd hello/
</span></span></code></pre></div></li>
<li>
<p><strong>Create <code>flake.nix</code> (Initial Impure Example):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span><span style="color:#75715e"># flake.nix</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  outputs <span style="color:#f92672">=</span> { self<span style="color:#f92672">,</span> nixpkgs }: {
</span></span><span style="display:flex;"><span>    myHello <span style="color:#f92672">=</span> (<span style="color:#f92672">import</span> nixpkgs {})<span style="color:#f92672">.</span>hello;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Note: Flakes don&rsquo;t have access to <code>builtins.currentSystem</code> directly.</li>
</ul>
</li>
<li>
<p><strong>Impure Build (Fails):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix build .#myHello
</span></span></code></pre></div><ul>
<li>This fails because Flakes enforce purity by default.</li>
</ul>
</li>
<li>
<p><strong>Force Impure Build:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix build .#myHello --impure
</span></span></code></pre></div></li>
<li>
<p><strong>Making the Flake Pure:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span><span style="color:#75715e"># flake.nix</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  inputs <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    nixpkgs<span style="color:#f92672">.</span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;github:NixOS/nixpkgs&#34;</span>;
</span></span><span style="display:flex;"><span>    flake-utils<span style="color:#f92672">.</span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;github:numtide/flake-utils&#34;</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  outputs <span style="color:#f92672">=</span> { self<span style="color:#f92672">,</span> nixpkgs<span style="color:#f92672">,</span> flake-utils }:
</span></span><span style="display:flex;"><span>    flake-utils<span style="color:#f92672">.</span>lib<span style="color:#f92672">.</span>eachDefaultSystem (system:
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span>
</span></span><span style="display:flex;"><span>        pkgs <span style="color:#f92672">=</span> nixpkgs<span style="color:#f92672">.</span>legacyPackages<span style="color:#f92672">.</span><span style="color:#e6db74">${</span>system<span style="color:#e6db74">}</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">in</span> {
</span></span><span style="display:flex;"><span>        packages<span style="color:#f92672">.</span>myHello <span style="color:#f92672">=</span> pkgs<span style="color:#f92672">.</span>hello;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li><code>flake-utils</code> simplifies making flakes system-agnostic and provides the <code>system</code> attribute.</li>
</ul>
</li>
<li>
<p><strong>Pure Build (Success):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix build .#myHello
</span></span></code></pre></div></li>
</ol>
<h2 id="using-traditional-nix">Using Traditional Nix<a hidden class="anchor" aria-hidden="true" href="#using-traditional-nix">#</a></h2>
<ol>
<li>
<p><strong>Setup:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir hello2 <span style="color:#f92672">&amp;&amp;</span> cd hello2/
</span></span></code></pre></div></li>
<li>
<p><strong>Create <code>default.nix</code> (Initial Impure Example):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span><span style="color:#75715e"># default.nix</span>
</span></span><span style="display:flex;"><span>{ myHello <span style="color:#f92672">=</span> (<span style="color:#f92672">import</span> <span style="color:#e6db74">&lt;nixpkgs&gt;</span> { })<span style="color:#f92672">.</span>hello; }
</span></span></code></pre></div></li>
<li>
<p><strong>Build (Impure):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix-build -A myHello
</span></span></code></pre></div></li>
<li>
<p><strong>Impurity Explained:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix repl
</span></span><span style="display:flex;"><span>nix-repl&gt; &lt;nixpkgs&gt;
</span></span><span style="display:flex;"><span>/nix/var/nix/profiles/per-user/root/channels/nixos
</span></span></code></pre></div><ul>
<li><code>&lt;nixpkgs&gt;</code> depends on the user&rsquo;s environment (Nixpkgs channel), making it impure. Even with channels disabled, it relies on a specific Nixpkgs version in the store.</li>
</ul>
</li>
<li>
<p><strong>Achieving Purity: Using <code>fetchTarball</code></strong></p>
<ul>
<li>
<p>GitHub allows downloading repository snapshots at specific commits, crucial for reproducibility.</p>
</li>
<li>
<p><strong>Get Nixpkgs Revision from <code>flake.lock</code> (from the Flake example):</strong></p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span><span style="color:#75715e"># flake.lock</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;nixpkgs&#34;</span>: {
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;locked&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;lastModified&#34;</span>: <span style="color:#ae81ff">1746372124</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;narHash&#34;</span>: <span style="color:#e6db74">&#34;sha256-n7W8Y6bL7mgHYW1vkXKi9zi/sV4UZqcBovICQu0rdNU=&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;owner&#34;</span>: <span style="color:#e6db74">&#34;NixOS&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;repo&#34;</span>: <span style="color:#e6db74">&#34;nixpkgs&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;rev&#34;</span>: <span style="color:#e6db74">&#34;f5cbfa4dbbe026c155cf5a9204f3e9121d3a5fe0&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;github&#34;</span>
</span></span><span style="display:flex;"><span>  }<span style="color:#f92672">,</span>
</span></span></code></pre></div></li>
<li>
<p><strong>Modify <code>default.nix</code> for Purity:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span><span style="color:#75715e"># default.nix</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span>
</span></span><span style="display:flex;"><span>  nixpkgs <span style="color:#f92672">=</span> fetchTarball {
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;[https://github.com/NixOS/nixpkgs/archive/f5cbfa4dbbe026c155cf5a9204f3e9121d3a5fe0.tar.gz](https://github.com/NixOS/nixpkgs/archive/f5cbfa4dbbe026c155cf5a9204f3e9121d3a5fe0.tar.gz)&#34;</span>;
</span></span><span style="display:flex;"><span>    sha256 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0000000000000000000000000000000000000000000000000000&#34;</span>; <span style="color:#75715e"># Placeholder</span>
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">in</span> {
</span></span><span style="display:flex;"><span>  myHello <span style="color:#f92672">=</span> (<span style="color:#f92672">import</span> nixpkgs {})<span style="color:#f92672">.</span>hello;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Replace <code>&lt;nixpkgs&gt;</code> with <code>fetchTarball</code> and a specific revision. A placeholder <code>sha256</code> is used initially.</li>
</ul>
</li>
<li>
<p><strong>Build (Nix provides the correct <code>sha256</code>):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix-build -A myHello
</span></span></code></pre></div></li>
<li>
<p><strong>Verification:</strong> Both Flake and Traditional Nix builds now produce the same output path.</p>
</li>
<li>
<p><strong>Remaining Impurities in Traditional Nix:</strong></p>
<ul>
<li>Default arguments to <code>import &lt;nixpkgs&gt; {}</code> can introduce impurity:
<ul>
<li><code>overlays</code>: <code>~/.config/nixpkgs/overlays</code> (user-specific)</li>
<li><code>config</code>: <code>~/.config/nixpkgs/config.nix</code> (user-specific)</li>
<li><code>system</code>: <code>builtins.currentSystem</code> (machine-specific)</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Making Traditional Nix Fully Pure:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span><span style="color:#75715e"># default.nix</span>
</span></span><span style="display:flex;"><span>{system <span style="color:#f92672">?</span> builtins<span style="color:#f92672">.</span>currentSystem}:
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span>
</span></span><span style="display:flex;"><span>  nixpkgs <span style="color:#f92672">=</span> fetchTarball {
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;[https://github.com/NixOS/nixpkgs/archive/0243fb86a6f43e506b24b4c0533bd0b0de211c19.tar.gz](https://github.com/NixOS/nixpkgs/archive/0243fb86a6f43e506b24b4c0533bd0b0de211c19.tar.gz)&#34;</span>;
</span></span><span style="display:flex;"><span>    sha256 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1qvdbvdza7hsqhra0yg7xs252pr1q70nyrsdj6570qv66vq0fjnh&#34;</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">in</span> {
</span></span><span style="display:flex;"><span>  myHello <span style="color:#f92672">=</span> (<span style="color:#f92672">import</span> nixpkgs {
</span></span><span style="display:flex;"><span>    overlays <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    config <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">inherit</span> system;
</span></span><span style="display:flex;"><span>  })<span style="color:#f92672">.</span>hello;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Override impure defaults for <code>overlays</code>, <code>config</code>, and make <code>system</code> an argument.</li>
</ul>
</li>
<li>
<p><strong>Building with a Specific System:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix-build -A myHello --argstr system x86_64-linux
</span></span></code></pre></div></li>
<li>
<p><strong>Pure Evaluation Mode in Traditional Nix:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix-instantiate --eval --pure-eval --expr <span style="color:#e6db74">&#39;fetchGit { url = ./.; rev = &#34;b4fe677e255c6f89c9a6fdd3ddd9319b0982b1ad&#34;; }&#39;</span>
</span></span></code></pre></div><ul>
<li>Example of using <code>--pure-eval</code>.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix-build --pure-eval --expr <span style="color:#e6db74">&#39;(import (fetchGit { url = ./.; rev = &#34;b4fe677e255c6f89c9a6fdd3ddd9319b0982b1ad&#34;; }) { system = &#34;x86_64-linux&#34;; }).myHello&#39;</span>
</span></span></code></pre></div><ul>
<li>Building with a specific revision and system.</li>
</ul>
</li>
</ol>
<h3 id="updating-nixpkgs">Updating Nixpkgs<a hidden class="anchor" aria-hidden="true" href="#updating-nixpkgs">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix flake update
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span>nix build <span style="color:#f92672">.</span><span style="color:#75715e">#myHello --override-input nixpkgs github:NixOS/nixpkgs/nixos-24.11</span>
</span></span></code></pre></div><h3 id="updating-traditional-nix-using-niv">Updating Traditional Nix (using <code>niv</code>)<a hidden class="anchor" aria-hidden="true" href="#updating-traditional-nix-using-niv">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span>nix-shell <span style="color:#960050;background-color:#1e0010">-</span>p niv
</span></span><span style="display:flex;"><span>niv init
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span><span style="color:#75715e"># default.nix</span>
</span></span><span style="display:flex;"><span>{ system <span style="color:#f92672">?</span> builtins<span style="color:#f92672">.</span>currentSystem<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>  sources <span style="color:#f92672">?</span> <span style="color:#f92672">import</span> <span style="color:#e6db74">nix/sources.nix</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>  nixpkgs <span style="color:#f92672">?</span> sources<span style="color:#f92672">.</span>nixpkgs<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>  pkgs <span style="color:#f92672">?</span> <span style="color:#f92672">import</span> nixpkgs {
</span></span><span style="display:flex;"><span>    overlays <span style="color:#f92672">=</span> [ ];
</span></span><span style="display:flex;"><span>    config <span style="color:#f92672">=</span> { };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">inherit</span> system;
</span></span><span style="display:flex;"><span>  }<span style="color:#f92672">,</span> }: {
</span></span><span style="display:flex;"><span>  myHello <span style="color:#f92672">=</span> pkgs<span style="color:#f92672">.</span>hello;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And build it with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix-build -A myHello
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>niv update nixpkgs --branch<span style="color:#f92672">=</span>nixos-unstable
</span></span><span style="display:flex;"><span>nix-build -A myHello
</span></span></code></pre></div><h4 id="adding-home-manager-with-flakes">Adding Home-Manager with Flakes<a hidden class="anchor" aria-hidden="true" href="#adding-home-manager-with-flakes">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span><span style="color:#75715e"># flake.nix</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  inputs <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    nixpkgs<span style="color:#f92672">.</span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;github:NixOS/nixpkgs&#34;</span>;
</span></span><span style="display:flex;"><span>    flake-utils<span style="color:#f92672">.</span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;github:numtide/flake-utils&#34;</span>;
</span></span><span style="display:flex;"><span>    home-manager<span style="color:#f92672">.</span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;github:nix-community/home-manager&#34;</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  outputs <span style="color:#f92672">=</span> { self<span style="color:#f92672">,</span> nixpkgs<span style="color:#f92672">,</span> flake-utils<span style="color:#f92672">,</span> home-manager<span style="color:#f92672">,</span> <span style="color:#f92672">...</span> }:
</span></span><span style="display:flex;"><span>    flake-utils<span style="color:#f92672">.</span>lib<span style="color:#f92672">.</span>eachDefaultSystem (system:
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> pkgs <span style="color:#f92672">=</span> nixpkgs<span style="color:#f92672">.</span>legacyPackages<span style="color:#f92672">.</span><span style="color:#e6db74">${</span>system<span style="color:#e6db74">}</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">in</span> {
</span></span><span style="display:flex;"><span>        packages<span style="color:#f92672">.</span>myHello <span style="color:#f92672">=</span> pkgs<span style="color:#f92672">.</span>hello;
</span></span><span style="display:flex;"><span>        packages<span style="color:#f92672">.</span>x86_64-linux<span style="color:#f92672">.</span>homeManagerDocs <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>          home-manager<span style="color:#f92672">.</span>packages<span style="color:#f92672">.</span>x86_64-linux<span style="color:#f92672">.</span>docs-html;
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix flake update
</span></span><span style="display:flex;"><span>nix flake show github:nix-community/home-manager
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span>home-manager<span style="color:#f92672">.</span>inputs<span style="color:#f92672">.</span>follows <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;nixpkgs&#34;</span>;
</span></span></code></pre></div><h4 id="adding-home-manager-with-traditional-nix">Adding Home-Manager with Traditional Nix<a hidden class="anchor" aria-hidden="true" href="#adding-home-manager-with-traditional-nix">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span>niv add <span style="color:#e6db74">nix-community/home-manager</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span>nix repl
</span></span><span style="display:flex;"><span>nix-repl<span style="color:#f92672">&gt;</span> s <span style="color:#f92672">=</span> <span style="color:#f92672">import</span> <span style="color:#e6db74">./nix/sources.nix</span>
</span></span><span style="display:flex;"><span>nix-repl<span style="color:#f92672">&gt;</span> s<span style="color:#f92672">.</span>home-manager
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span>{ system <span style="color:#f92672">?</span> builtins<span style="color:#f92672">.</span>currentSystem<span style="color:#f92672">,</span> sources <span style="color:#f92672">?</span> <span style="color:#f92672">import</span> <span style="color:#e6db74">nix/sources.nix</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">,</span> nixpkgs <span style="color:#f92672">?</span> sources<span style="color:#f92672">.</span>nixpkgs<span style="color:#f92672">,</span> pkgs <span style="color:#f92672">?</span> <span style="color:#f92672">import</span> nixpkgs {
</span></span><span style="display:flex;"><span>    overlays <span style="color:#f92672">=</span> [ ];
</span></span><span style="display:flex;"><span>    config <span style="color:#f92672">=</span> { };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">inherit</span> system;
</span></span><span style="display:flex;"><span>  }<span style="color:#f92672">,</span> }: {
</span></span><span style="display:flex;"><span>  homeManagerDocs <span style="color:#f92672">=</span> (<span style="color:#f92672">import</span> sources<span style="color:#f92672">.</span>home-manager { pkgs <span style="color:#f92672">=</span> pkgs; })<span style="color:#f92672">.</span>docs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  myHello <span style="color:#f92672">=</span> pkgs<span style="color:#f92672">.</span>hello;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nix-build -A homeManagerDocs
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">NixOS Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
